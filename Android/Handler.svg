<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than draw.io -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1490px" height="895px" viewBox="-0.5 -0.5 1490 895" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2024-04-09T03:52:56.640Z&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36&quot; etag=&quot;EKUxoQzci4Qc3cFUE8YP&quot; version=&quot;24.2.0&quot; type=&quot;device&quot; pages=&quot;2&quot;&gt;&#10;  &lt;diagram id=&quot;KgLerE87KBL7YLeJpYM6&quot; name=&quot;Handle&quot;&gt;&#10;    &lt;mxGraphModel dx=&quot;254&quot; dy=&quot;1378&quot; grid=&quot;1&quot; gridSize=&quot;10&quot; guides=&quot;1&quot; tooltips=&quot;1&quot; connect=&quot;1&quot; arrows=&quot;1&quot; fold=&quot;1&quot; page=&quot;1&quot; pageScale=&quot;1&quot; pageWidth=&quot;827&quot; pageHeight=&quot;1169&quot; math=&quot;0&quot; shadow=&quot;0&quot;&gt;&#10;      &lt;root&gt;&#10;        &lt;mxCell id=&quot;0&quot; /&gt;&#10;        &lt;mxCell id=&quot;1&quot; parent=&quot;0&quot; /&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-1&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; parent=&quot;1&quot; source=&quot;SVF_KBN14g_UiQ-_b-FJ-2&quot; target=&quot;SVF_KBN14g_UiQ-_b-FJ-4&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-2&quot; value=&quot;&amp;lt;pre style=&amp;quot;font-size: 8px; text-align: left;&amp;quot;&amp;gt;发送消息&amp;lt;/pre&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;fontColor=default;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2760&quot; y=&quot;81&quot; width=&quot;120&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-3&quot; value=&quot;&amp;lt;pre style=&amp;quot;font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; font-size: 6px; text-align: left; color: rgb(187, 187, 187);&amp;quot;&amp;gt;&amp;lt;pre style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;public final boolean &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;sendMessage&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;@NonNull &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Message &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;return &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;sendMessageDelayed&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;0&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;}&amp;lt;/pre&amp;gt;&amp;lt;/pre&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#000000;fontSize=6;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2960&quot; y=&quot;76&quot; width=&quot;210&quot; height=&quot;44&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-30&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; parent=&quot;1&quot; source=&quot;SVF_KBN14g_UiQ-_b-FJ-4&quot; target=&quot;SVF_KBN14g_UiQ-_b-FJ-29&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-4&quot; value=&quot;&amp;lt;pre style=&amp;quot;font-size: 8px; text-align: left;&amp;quot;&amp;gt;发送延时消息&amp;lt;/pre&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;fontColor=default;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2760&quot; y=&quot;160&quot; width=&quot;120&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-13&quot; value=&quot;&amp;lt;pre style=&amp;quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;public final boolean &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;sendMessageDelayed&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;@NonNull &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Message &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;long &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;delayMillis&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;delayMillis &amp;lt;/span&amp;gt;&amp;amp;lt; &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;0&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;delayMillis &amp;lt;/span&amp;gt;= &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;0&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;return &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;sendMessageAtTime&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;SystemClock&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;uptimeMillis&amp;lt;/span&amp;gt;() + &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;delayMillis&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;}&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;pre style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;public boolean &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;sendMessageAtTime&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;@NonNull &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Message &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;long &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;uptimeMillis&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;MessageQueue &amp;lt;/span&amp;gt;queue = &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;mQueue&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(queue == &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;null&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Log&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;w&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(137, 202, 120); font-size: 6px;&amp;quot;&amp;gt;&amp;quot;Looper&amp;quot;&amp;lt;/span&amp;gt;, &amp;quot;sendMessageAtTime() called with no mQueue&amp;quot;, e);&amp;lt;br&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;return false&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;return &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;enqueueMessage&amp;lt;/span&amp;gt;(queue, &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;uptimeMillis&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;}&amp;lt;/pre&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/pre&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;labelBackgroundColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2960&quot; y=&quot;130&quot; width=&quot;310&quot; height=&quot;120&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-18&quot; value=&quot;Handler&quot; style=&quot;swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2131&quot; y=&quot;36&quot; width=&quot;309&quot; height=&quot;110&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxRectangle x=&quot;2131&quot; y=&quot;36&quot; width=&quot;80&quot; height=&quot;30&quot; as=&quot;alternateBounds&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-19&quot; value=&quot;+ mLooper:Looper&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;+ mQueue:MessageQueue&amp;lt;/div&amp;gt;&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-18&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;26&quot; width=&quot;309&quot; height=&quot;34&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-20&quot; value=&quot;&quot; style=&quot;line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;fontSize=8;&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-18&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;60&quot; width=&quot;309&quot; height=&quot;8&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-21&quot; value=&quot;+&amp;amp;nbsp;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;sendMessageAtTime&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial; font-style: italic;&amp;quot;&amp;gt;@NonNull &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;Message &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial; font-style: italic;&amp;quot;&amp;gt;long &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;uptimeMillis&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;)&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-size: 8px;&amp;quot;&amp;gt;:&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-style: italic; font-size: 8px; background-color: initial;&amp;quot;&amp;gt;boolean&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;+&amp;amp;nbsp;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;enqueueMessage&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial; font-style: italic;&amp;quot;&amp;gt;@NonNull &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;MessageQueue &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;queue&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial; font-style: italic;&amp;quot;&amp;gt;@NonNull &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;Message &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;,&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial; font-style: italic;&amp;quot;&amp;gt;long &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;uptimeMillis&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;)&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-size: 8px;&amp;quot;&amp;gt;:&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-style: italic; font-size: 8px;&amp;quot;&amp;gt;boolean&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;br style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#000000;fontSize=8;&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-18&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;68&quot; width=&quot;309&quot; height=&quot;42&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-34&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; parent=&quot;1&quot; source=&quot;SVF_KBN14g_UiQ-_b-FJ-29&quot; target=&quot;SVF_KBN14g_UiQ-_b-FJ-33&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-35&quot; value=&quot;调用MessageQueue类的入队方法&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-34&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;0.5383&quot; y=&quot;2&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint as=&quot;offset&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-29&quot; value=&quot;&amp;lt;pre style=&amp;quot;font-size: 8px; text-align: left;&amp;quot;&amp;gt;消息入队&amp;lt;/pre&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;fontColor=default;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2760&quot; y=&quot;220&quot; width=&quot;120&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-32&quot; value=&quot;&amp;lt;pre style=&amp;quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;private boolean &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;enqueueMessage&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;@NonNull &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;MessageQueue &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;queue&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;@NonNull &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Message &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;,&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;long &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;uptimeMillis&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.target = &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;this&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.workSourceUid = &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;ThreadLocalWorkSource&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;getUid&amp;lt;/span&amp;gt;();&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;mAsynchronous&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;setAsynchronous&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;true&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;return &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;queue&amp;lt;/span&amp;gt;.enqueueMessage(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;uptimeMillis&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;}&amp;lt;/pre&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2960&quot; y=&quot;249&quot; width=&quot;310&quot; height=&quot;91&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-41&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; parent=&quot;1&quot; source=&quot;SVF_KBN14g_UiQ-_b-FJ-33&quot; target=&quot;SVF_KBN14g_UiQ-_b-FJ-40&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-33&quot; value=&quot;&amp;lt;pre style=&amp;quot;font-size: 8px; text-align: left;&amp;quot;&amp;gt;消息入队&amp;lt;/pre&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;fontColor=default;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2760&quot; y=&quot;298.75&quot; width=&quot;120&quot; height=&quot;20&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;UserObject label=&quot;&amp;lt;pre style=&amp;quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;boolean &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;enqueueMessage&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Message &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;long &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;when&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.target == &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;null&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;throw new &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;IllegalArgumentException&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(137, 202, 120); font-size: 6px;&amp;quot;&amp;gt;&amp;quot;Message must have a target.&amp;quot;&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;synchronized &amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;this&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.isInUse()) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;throw new &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;IllegalStateException&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg &amp;lt;/span&amp;gt;+ &amp;lt;span style=&amp;quot;color: rgb(137, 202, 120); font-size: 6px;&amp;quot;&amp;gt;&amp;quot; This message is already in use.&amp;quot;&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;mQuitting&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;IllegalStateException &amp;lt;/span&amp;gt;e = &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;new &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;IllegalStateException&amp;lt;/span&amp;gt;(&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;                    &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.target + &amp;lt;span style=&amp;quot;color: rgb(137, 202, 120); font-size: 6px;&amp;quot;&amp;gt;&amp;quot; sending message to a Handler on a dead thread&amp;quot;&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Log&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;w&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;TAG&amp;lt;/span&amp;gt;, e.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;getMessage&amp;lt;/span&amp;gt;(), e);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;recycle&amp;lt;/span&amp;gt;();&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;return false&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.markInUse();&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.when = &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;when&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Message &amp;lt;/span&amp;gt;p = &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;mMessages&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;boolean &amp;lt;/span&amp;gt;needWake;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(p == &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;null &amp;lt;/span&amp;gt;|| &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;when &amp;lt;/span&amp;gt;== &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;0 &amp;lt;/span&amp;gt;|| &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;when &amp;lt;/span&amp;gt;&amp;amp;lt; p.when) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;// New head, wake up the event queue if blocked.&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.next = p;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;mMessages &amp;lt;/span&amp;gt;= &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            needWake = &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;mBlocked&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        } &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;else &amp;lt;/span&amp;gt;{&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;// Inserted within the middle of the queue.  Usually we don&amp;#39;t have to wake&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;            // up the event queue unless there is a barrier at the head of the queue&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;            // and the message is the earliest asynchronous message in the queue.&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;/span&amp;gt;needWake = &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;mBlocked &amp;lt;/span&amp;gt;&amp;amp;amp;&amp;amp;amp; p.target == &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;null &amp;lt;/span&amp;gt;&amp;amp;amp;&amp;amp;amp; &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;isAsynchronous&amp;lt;/span&amp;gt;();&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Message &amp;lt;/span&amp;gt;prev;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;for &amp;lt;/span&amp;gt;(;;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;                prev = p;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;                p = p.next;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;                &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(p == &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;null &amp;lt;/span&amp;gt;|| &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;when &amp;lt;/span&amp;gt;&amp;amp;lt; p.when) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;                    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;break&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;                }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;                &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(needWake &amp;amp;amp;&amp;amp;amp; p.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;isAsynchronous&amp;lt;/span&amp;gt;()) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;                    needWake = &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;false&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;                }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.next = p; &amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;// invariant: p == prev.next&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;/span&amp;gt;prev.next = &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;// We can assume mPtr != 0 because mQuitting is false.&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(needWake) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;nativeWake&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;mPtr&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;return true&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;}&amp;lt;/pre&amp;gt;&quot; link=&quot;&amp;lt;pre style=&amp;quot;color: rgb(187, 187, 187); font-size: 20px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;boolean &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239);&amp;quot;&amp;gt;enqueueMessage&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;Message &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;long &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;when&amp;lt;/span&amp;gt;) {&amp;lt;br&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.target == &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;null&amp;lt;/span&amp;gt;) {&amp;lt;br&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;throw new &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;IllegalArgumentException&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(137, 202, 120);&amp;quot;&amp;gt;&amp;quot;Message must have a target.&amp;quot;&amp;lt;/span&amp;gt;);&amp;lt;br&amp;gt;    }&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;synchronized &amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;this&amp;lt;/span&amp;gt;) {&amp;lt;br&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.isInUse()) {&amp;lt;br&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;throw new &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;IllegalStateException&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;msg &amp;lt;/span&amp;gt;+ &amp;lt;span style=&amp;quot;color: rgb(137, 202, 120);&amp;quot;&amp;gt;&amp;quot; This message is already in use.&amp;quot;&amp;lt;/span&amp;gt;);&amp;lt;br&amp;gt;        }&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(239, 89, 111);&amp;quot;&amp;gt;mQuitting&amp;lt;/span&amp;gt;) {&amp;lt;br&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;IllegalStateException &amp;lt;/span&amp;gt;e = &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;new &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;IllegalStateException&amp;lt;/span&amp;gt;(&amp;lt;br&amp;gt;                    &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.target + &amp;lt;span style=&amp;quot;color: rgb(137, 202, 120);&amp;quot;&amp;gt;&amp;quot; sending message to a Handler on a dead thread&amp;quot;&amp;lt;/span&amp;gt;);&amp;lt;br&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;Log&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239);&amp;quot;&amp;gt;w&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;TAG&amp;lt;/span&amp;gt;, e.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239);&amp;quot;&amp;gt;getMessage&amp;lt;/span&amp;gt;(), e);&amp;lt;br&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239);&amp;quot;&amp;gt;recycle&amp;lt;/span&amp;gt;();&amp;lt;br&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;return false&amp;lt;/span&amp;gt;;&amp;lt;br&amp;gt;        }&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.markInUse();&amp;lt;br&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.when = &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;when&amp;lt;/span&amp;gt;;&amp;lt;br&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;Message &amp;lt;/span&amp;gt;p = &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111);&amp;quot;&amp;gt;mMessages&amp;lt;/span&amp;gt;;&amp;lt;br&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;boolean &amp;lt;/span&amp;gt;needWake;&amp;lt;br&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(p == &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;null &amp;lt;/span&amp;gt;|| &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;when &amp;lt;/span&amp;gt;== &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;0 &amp;lt;/span&amp;gt;|| &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;when &amp;lt;/span&amp;gt;&amp;amp;lt; p.when) {&amp;lt;br&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic;&amp;quot;&amp;gt;// New head, wake up the event queue if blocked.&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic;&amp;quot;&amp;gt;            &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.next = p;&amp;lt;br&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111);&amp;quot;&amp;gt;mMessages &amp;lt;/span&amp;gt;= &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;;&amp;lt;br&amp;gt;            needWake = &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111);&amp;quot;&amp;gt;mBlocked&amp;lt;/span&amp;gt;;&amp;lt;br&amp;gt;        } &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;else &amp;lt;/span&amp;gt;{&amp;lt;br&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic;&amp;quot;&amp;gt;// Inserted within the middle of the queue.  Usually we don&amp;#39;t have to wake&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic;&amp;quot;&amp;gt;            // up the event queue unless there is a barrier at the head of the queue&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic;&amp;quot;&amp;gt;            // and the message is the earliest asynchronous message in the queue.&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic;&amp;quot;&amp;gt;            &amp;lt;/span&amp;gt;needWake = &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111);&amp;quot;&amp;gt;mBlocked &amp;lt;/span&amp;gt;&amp;amp;amp;&amp;amp;amp; p.target == &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;null &amp;lt;/span&amp;gt;&amp;amp;amp;&amp;amp;amp; &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239);&amp;quot;&amp;gt;isAsynchronous&amp;lt;/span&amp;gt;();&amp;lt;br&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;Message &amp;lt;/span&amp;gt;prev;&amp;lt;br&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;for &amp;lt;/span&amp;gt;(;;) {&amp;lt;br&amp;gt;                prev = p;&amp;lt;br&amp;gt;                p = p.next;&amp;lt;br&amp;gt;                &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(p == &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;null &amp;lt;/span&amp;gt;|| &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;when &amp;lt;/span&amp;gt;&amp;amp;lt; p.when) {&amp;lt;br&amp;gt;                    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;break&amp;lt;/span&amp;gt;;&amp;lt;br&amp;gt;                }&amp;lt;br&amp;gt;                &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(needWake &amp;amp;amp;&amp;amp;amp; p.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239);&amp;quot;&amp;gt;isAsynchronous&amp;lt;/span&amp;gt;()) {&amp;lt;br&amp;gt;                    needWake = &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;false&amp;lt;/span&amp;gt;;&amp;lt;br&amp;gt;                }&amp;lt;br&amp;gt;            }&amp;lt;br&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;.next = p; &amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic;&amp;quot;&amp;gt;// invariant: p == prev.next&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic;&amp;quot;&amp;gt;            &amp;lt;/span&amp;gt;prev.next = &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;msg&amp;lt;/span&amp;gt;;&amp;lt;br&amp;gt;        }&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic;&amp;quot;&amp;gt;// We can assume mPtr != 0 because mQuitting is false.&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic;&amp;quot;&amp;gt;        &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(needWake) {&amp;lt;br&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(97, 175, 239);&amp;quot;&amp;gt;nativeWake&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(239, 89, 111);&amp;quot;&amp;gt;mPtr&amp;lt;/span&amp;gt;);&amp;lt;br&amp;gt;        }&amp;lt;br&amp;gt;    }&amp;lt;br&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;return true&amp;lt;/span&amp;gt;;&amp;lt;br&amp;gt;}&amp;lt;/pre&amp;gt;&quot; id=&quot;SVF_KBN14g_UiQ-_b-FJ-39&quot;&gt;&#10;          &lt;mxCell style=&quot;text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;            &lt;mxGeometry x=&quot;2960&quot; y=&quot;340&quot; width=&quot;320&quot; height=&quot;410&quot; as=&quot;geometry&quot; /&gt;&#10;          &lt;/mxCell&gt;&#10;        &lt;/UserObject&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-43&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; parent=&quot;1&quot; source=&quot;SVF_KBN14g_UiQ-_b-FJ-40&quot; target=&quot;SVF_KBN14g_UiQ-_b-FJ-42&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-44&quot; value=&quot;否&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-43&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-0.0769&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint as=&quot;offset&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-46&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; parent=&quot;1&quot; source=&quot;SVF_KBN14g_UiQ-_b-FJ-40&quot; target=&quot;SVF_KBN14g_UiQ-_b-FJ-45&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-50&quot; value=&quot;是&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-46&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-0.1917&quot; y=&quot;1&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint as=&quot;offset&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-40&quot; value=&quot;判断msg是否有对应的handler&quot; style=&quot;rhombus;whiteSpace=wrap;html=1;rounded=0;fontSize=6;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2780&quot; y=&quot;340&quot; width=&quot;80&quot; height=&quot;80&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-42&quot; value=&quot;扔异常&quot; style=&quot;whiteSpace=wrap;html=1;fontSize=6;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2670&quot; y=&quot;370&quot; width=&quot;50&quot; height=&quot;20&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-48&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; parent=&quot;1&quot; source=&quot;SVF_KBN14g_UiQ-_b-FJ-45&quot; target=&quot;SVF_KBN14g_UiQ-_b-FJ-47&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-49&quot; value=&quot;是&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-48&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-0.2&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint as=&quot;offset&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-52&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; parent=&quot;1&quot; source=&quot;SVF_KBN14g_UiQ-_b-FJ-45&quot; target=&quot;SVF_KBN14g_UiQ-_b-FJ-51&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-56&quot; value=&quot;否&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-52&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-0.1&quot; y=&quot;1&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint as=&quot;offset&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-45&quot; value=&quot;判断msg是否已经被使用了&quot; style=&quot;rhombus;whiteSpace=wrap;html=1;rounded=0;fontSize=6;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2780&quot; y=&quot;455&quot; width=&quot;80&quot; height=&quot;80&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-47&quot; value=&quot;扔异常&quot; style=&quot;whiteSpace=wrap;html=1;fontSize=6;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2680&quot; y=&quot;485&quot; width=&quot;40&quot; height=&quot;20&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-54&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; parent=&quot;1&quot; source=&quot;SVF_KBN14g_UiQ-_b-FJ-51&quot; target=&quot;SVF_KBN14g_UiQ-_b-FJ-53&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-55&quot; value=&quot;是&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-54&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-0.2222&quot; y=&quot;1&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint as=&quot;offset&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-69&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; parent=&quot;1&quot; source=&quot;SVF_KBN14g_UiQ-_b-FJ-51&quot; target=&quot;SVF_KBN14g_UiQ-_b-FJ-68&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-70&quot; value=&quot;否&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-69&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-0.4271&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint as=&quot;offset&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-51&quot; value=&quot;判断当前handle所在的线程是否正在退出&quot; style=&quot;rhombus;whiteSpace=wrap;html=1;rounded=0;fontSize=6;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2780&quot; y=&quot;566.75&quot; width=&quot;80&quot; height=&quot;80&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-53&quot; value=&quot;销毁消息，返回false&quot; style=&quot;whiteSpace=wrap;html=1;fontSize=6;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2600&quot; y=&quot;591.75&quot; width=&quot;120&quot; height=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-57&quot; value=&quot;上锁，同步代码块&quot; style=&quot;text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2760&quot; y=&quot;455&quot; width=&quot;120&quot; height=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-58&quot; value=&quot;MessageQueue&quot; style=&quot;swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2130&quot; y=&quot;180&quot; width=&quot;310&quot; height=&quot;84&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-59&quot; value=&quot;+ mMessages: Message&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-58&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;26&quot; width=&quot;310&quot; height=&quot;24&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-60&quot; value=&quot;&quot; style=&quot;line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;fontSize=8;&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-58&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;50&quot; width=&quot;310&quot; height=&quot;8&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-61&quot; value=&quot;+ enqueueMessage(type): boolean&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-58&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;58&quot; width=&quot;310&quot; height=&quot;26&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-62&quot; value=&quot;Message&quot; style=&quot;swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2131&quot; y=&quot;337&quot; width=&quot;309&quot; height=&quot;144&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-63&quot; value=&quot;+ when: long&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;+ target:Handle&amp;lt;br style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;+ data:Bundle&amp;lt;br style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;+ next: Message&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;//由此构成消息的单项链表&amp;lt;br style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;+ sPool: Message&amp;lt;br style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;+ sPoolSize: int&amp;amp;nbsp;&amp;lt;br style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;+ MAX_POOL_SIZE: int // 50&amp;lt;br style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-62&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;26&quot; width=&quot;309&quot; height=&quot;84&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-64&quot; value=&quot;&quot; style=&quot;line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;fontSize=8;&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-62&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;110&quot; width=&quot;309&quot; height=&quot;8&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-65&quot; value=&quot;+ obtain(): Message&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-62&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;118&quot; width=&quot;309&quot; height=&quot;26&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-72&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; parent=&quot;1&quot; source=&quot;SVF_KBN14g_UiQ-_b-FJ-68&quot; target=&quot;SVF_KBN14g_UiQ-_b-FJ-71&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-73&quot; value=&quot;是&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-72&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-0.0111&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint as=&quot;offset&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-75&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; parent=&quot;1&quot; source=&quot;SVF_KBN14g_UiQ-_b-FJ-68&quot; target=&quot;SVF_KBN14g_UiQ-_b-FJ-74&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-76&quot; value=&quot;否&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-75&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-0.1278&quot; y=&quot;-3&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint as=&quot;offset&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-68&quot; value=&quot;判断msg链表是否为空&amp;lt;div&amp;gt;或者插入消息的when==0&amp;lt;br&amp;gt;或者when&amp;amp;lt;p.when&amp;lt;/div&amp;gt;&quot; style=&quot;rhombus;whiteSpace=wrap;html=1;rounded=0;fontSize=6;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2780&quot; y=&quot;726.75&quot; width=&quot;80&quot; height=&quot;80&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-71&quot; value=&quot;将消息插在队列头部&quot; style=&quot;whiteSpace=wrap;html=1;fontSize=6;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2600&quot; y=&quot;756.75&quot; width=&quot;120&quot; height=&quot;20&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-74&quot; value=&quot;将消息插入消息链表对应的位置&quot; style=&quot;whiteSpace=wrap;html=1;fontSize=6;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2760&quot; y=&quot;870&quot; width=&quot;120&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-77&quot; value=&quot;Looper&quot; style=&quot;swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2130&quot; y=&quot;550&quot; width=&quot;310&quot; height=&quot;160&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-78&quot; value=&quot;+ sThreadLocal: ThreadLocal&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;+ sMainLooper: Looper&amp;lt;br style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;+ mQueue: MessageQueue&amp;lt;br style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;+ mThread: Thread&amp;lt;br style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-77&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;26&quot; width=&quot;310&quot; height=&quot;54&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-79&quot; value=&quot;&quot; style=&quot;line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;fontSize=8;&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-77&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;80&quot; width=&quot;310&quot; height=&quot;8&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;SVF_KBN14g_UiQ-_b-FJ-80&quot; value=&quot;+ prepareMainLooper():void //为主线程创建Looper对象&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;+ getMainLooper(): Looper //获取主线程的Looper对象&amp;lt;br style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial; font-size: 8px;&amp;quot;&amp;gt;+&amp;amp;nbsp;&amp;lt;/span&amp;gt;prepare(quitAllow): void // 每个线程只能调用一次&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;+ myLooper(): Looper //获取当前线程的Looper对象&amp;lt;br style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;+ loop(): void //死循环消息列表&amp;lt;br style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;+ loopOnce(): void&amp;lt;/div&amp;gt;&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;SVF_KBN14g_UiQ-_b-FJ-77&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;88&quot; width=&quot;310&quot; height=&quot;72&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;htp0pqVOB_GgmM7RNFBv-2&quot; value=&quot;&amp;lt;pre style=&amp;quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&amp;quot;&amp;gt;&amp;lt;pre&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;static final &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;ThreadLocal&amp;lt;/span&amp;gt;&amp;amp;lt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;Looper&amp;lt;/span&amp;gt;&amp;amp;gt; &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;sThreadLocal &amp;lt;/span&amp;gt;= &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;new &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;ThreadLocal&amp;lt;/span&amp;gt;&amp;amp;lt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;Looper&amp;lt;/span&amp;gt;&amp;amp;gt;();&amp;lt;/pre&amp;gt;&amp;lt;/pre&amp;gt;&amp;lt;pre style=&amp;quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;private static void &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;prepare&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;boolean &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;quitAllowed&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;sThreadLocal&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;get&amp;lt;/span&amp;gt;() != &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;null&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;throw new &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;RuntimeException&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(137, 202, 120); font-size: 6px;&amp;quot;&amp;gt;&amp;quot;Only one Looper may be created per thread&amp;quot;&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;sThreadLocal&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;set&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;new &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Looper&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;quitAllowed&amp;lt;/span&amp;gt;));&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;}&amp;lt;/pre&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;1790&quot; y=&quot;585&quot; width=&quot;330&quot; height=&quot;70&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;htp0pqVOB_GgmM7RNFBv-4&quot; value=&quot;&amp;lt;pre style=&amp;quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;public static &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;@Nullable &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Looper &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;myLooper&amp;lt;/span&amp;gt;() {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;return &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;sThreadLocal&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;get&amp;lt;/span&amp;gt;();&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;}&amp;lt;/pre&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;fillColor=#000000;fontSize=6;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;1790&quot; y=&quot;655&quot; width=&quot;200&quot; height=&quot;50&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;      &lt;/root&gt;&#10;    &lt;/mxGraphModel&gt;&#10;  &lt;/diagram&gt;&#10;  &lt;diagram id=&quot;B5dIO6AN51XFmtcyMUDD&quot; name=&quot;ThreadLocal&quot;&gt;&#10;    &lt;mxGraphModel dx=&quot;-594&quot; dy=&quot;766&quot; grid=&quot;1&quot; gridSize=&quot;10&quot; guides=&quot;1&quot; tooltips=&quot;1&quot; connect=&quot;1&quot; arrows=&quot;1&quot; fold=&quot;1&quot; page=&quot;1&quot; pageScale=&quot;1&quot; pageWidth=&quot;827&quot; pageHeight=&quot;1169&quot; math=&quot;0&quot; shadow=&quot;0&quot;&gt;&#10;      &lt;root&gt;&#10;        &lt;mxCell id=&quot;0&quot; /&gt;&#10;        &lt;mxCell id=&quot;1&quot; parent=&quot;0&quot; /&gt;&#10;        &lt;mxCell id=&quot;4JSQju-QF8H9R8TIQm2g-1&quot; value=&quot;ThreadLocal&quot; style=&quot;swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;1720&quot; y=&quot;40&quot; width=&quot;200&quot; height=&quot;130&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;4JSQju-QF8H9R8TIQm2g-2&quot; value=&quot;&amp;lt;div&amp;gt;-&amp;amp;nbsp;&amp;lt;span style=&amp;quot;font-size: 8px; background-color: initial;&amp;quot;&amp;gt;HASH_INCREMENT: int = 0x61c88647&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;&quot; parent=&quot;4JSQju-QF8H9R8TIQm2g-1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;26&quot; width=&quot;200&quot; height=&quot;26&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;4JSQju-QF8H9R8TIQm2g-3&quot; value=&quot;&quot; style=&quot;line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;&quot; parent=&quot;4JSQju-QF8H9R8TIQm2g-1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;52&quot; width=&quot;200&quot; height=&quot;8&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;4JSQju-QF8H9R8TIQm2g-4&quot; value=&quot;+ set(T): void&amp;lt;div&amp;gt;+ get(): T&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;getMap(Thread): ThreadLocalMap&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;createMap(Thread, T): void&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;&quot; parent=&quot;4JSQju-QF8H9R8TIQm2g-1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;60&quot; width=&quot;200&quot; height=&quot;70&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;4JSQju-QF8H9R8TIQm2g-5&quot; value=&quot;ThreadLocalMap&quot; style=&quot;swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;1720&quot; y=&quot;190&quot; width=&quot;190&quot; height=&quot;130&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;4JSQju-QF8H9R8TIQm2g-6&quot; value=&quot;- INITIAL_CAPACITY: int = 16&amp;lt;div&amp;gt;- table: Entry[]&amp;lt;/div&amp;gt;&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;&quot; parent=&quot;4JSQju-QF8H9R8TIQm2g-5&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;26&quot; width=&quot;190&quot; height=&quot;44&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;4JSQju-QF8H9R8TIQm2g-7&quot; value=&quot;&quot; style=&quot;line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;&quot; parent=&quot;4JSQju-QF8H9R8TIQm2g-5&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;70&quot; width=&quot;190&quot; height=&quot;8&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;4JSQju-QF8H9R8TIQm2g-8&quot; value=&quot;- set(T): void&amp;lt;div&amp;gt;- getEntry(ThreadLocal): Entry&amp;lt;/div&amp;gt;&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;&quot; parent=&quot;4JSQju-QF8H9R8TIQm2g-5&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;78&quot; width=&quot;190&quot; height=&quot;52&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;4JSQju-QF8H9R8TIQm2g-9&quot; value=&quot;&amp;lt;pre style=&amp;quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;public void &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;set&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;T &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;value&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Thread &amp;lt;/span&amp;gt;t = &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Thread&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;currentThread&amp;lt;/span&amp;gt;();&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;ThreadLocalMap &amp;lt;/span&amp;gt;map = &amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;getMap&amp;lt;/span&amp;gt;(t);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(map != &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;null&amp;lt;/span&amp;gt;)&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        map.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;set&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;this&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;value&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;else&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;createMap&amp;lt;/span&amp;gt;(t, &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;value&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;}&amp;lt;br&amp;gt;&amp;lt;pre&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;public &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;T &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239);&amp;quot;&amp;gt;get&amp;lt;/span&amp;gt;() {&amp;lt;br&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;Thread &amp;lt;/span&amp;gt;t = &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;Thread&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239);&amp;quot;&amp;gt;currentThread&amp;lt;/span&amp;gt;();&amp;lt;br&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;ThreadLocalMap &amp;lt;/span&amp;gt;map = &amp;lt;span style=&amp;quot;color: rgb(97, 175, 239);&amp;quot;&amp;gt;getMap&amp;lt;/span&amp;gt;(t);&amp;lt;br&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(map != &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;null&amp;lt;/span&amp;gt;) {&amp;lt;br&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;ThreadLocalMap&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;Entry &amp;lt;/span&amp;gt;e = map.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239);&amp;quot;&amp;gt;getEntry&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;this&amp;lt;/span&amp;gt;);&amp;lt;br&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(e != &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;null&amp;lt;/span&amp;gt;) {&amp;lt;br&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-style: italic;&amp;quot;&amp;gt;@SuppressWarnings&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(137, 202, 120);&amp;quot;&amp;gt;&amp;quot;unchecked&amp;quot;&amp;lt;/span&amp;gt;)&amp;lt;br&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;T &amp;lt;/span&amp;gt;result = (&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;T&amp;lt;/span&amp;gt;)e.&amp;lt;span style=&amp;quot;color: rgb(239, 89, 111);&amp;quot;&amp;gt;value&amp;lt;/span&amp;gt;;&amp;lt;br&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;return &amp;lt;/span&amp;gt;result;&amp;lt;br&amp;gt;        }&amp;lt;br&amp;gt;    }&amp;lt;br&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;return &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239);&amp;quot;&amp;gt;setInitialValue&amp;lt;/span&amp;gt;();&amp;lt;br&amp;gt;}&amp;lt;/pre&amp;gt;&amp;lt;pre&amp;gt;&amp;lt;br&amp;gt;&amp;lt;pre&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/pre&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/pre&amp;gt;&amp;lt;/pre&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;verticalAlign=top;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;1900&quot; y=&quot;451&quot; width=&quot;212&quot; height=&quot;180&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;4JSQju-QF8H9R8TIQm2g-11&quot; value=&quot;&amp;lt;pre style=&amp;quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;private void &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;set&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;ThreadLocal&amp;lt;/span&amp;gt;&amp;amp;lt;?&amp;amp;gt; &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;key&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Object &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;value&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;// We don&amp;#39;t use a fast path as with get() because it is at&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;    // least as common to use set() to create new entries as&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;    // it is to replace existing ones, in which case, a fast&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;    // path would fail more often than not.&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Entry&amp;lt;/span&amp;gt;[] tab = &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;table&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;int &amp;lt;/span&amp;gt;len = tab.&amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;length&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;int &amp;lt;/span&amp;gt;i = &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;key&amp;lt;/span&amp;gt;.threadLocalHashCode &amp;amp;amp; (len-&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;1&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;for &amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Entry &amp;lt;/span&amp;gt;e = tab[i];&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;         e != &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;null&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;         e = tab[i = &amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;nextIndex&amp;lt;/span&amp;gt;(i, len)]) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;// Android-changed: Use refersTo() (twice).&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;        // ThreadLocal&amp;amp;lt;?&amp;amp;gt; k = e.get();&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;        // if (k == key) { ... } if (k == null) { ... }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(e.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;refersTo&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;key&amp;lt;/span&amp;gt;)) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            e.&amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;value &amp;lt;/span&amp;gt;= &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;value&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;return&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(e.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;refersTo&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;null&amp;lt;/span&amp;gt;)) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;replaceStaleEntry&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;key&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;value&amp;lt;/span&amp;gt;, i);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;return&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    tab[i] = &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;new &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Entry&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;key&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;value&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;int &amp;lt;/span&amp;gt;sz = ++&amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;size&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(!&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;cleanSomeSlots&amp;lt;/span&amp;gt;(i, sz) &amp;amp;amp;&amp;amp;amp; sz &amp;amp;gt;= &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;threshold&amp;lt;/span&amp;gt;)&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;rehash&amp;lt;/span&amp;gt;();&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;}&amp;lt;/pre&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;1862&quot; y=&quot;631&quot; width=&quot;250&quot; height=&quot;270&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;4JSQju-QF8H9R8TIQm2g-13&quot; value=&quot;&amp;lt;pre style=&amp;quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;private &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Entry &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;getEntry&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;ThreadLocal&amp;lt;/span&amp;gt;&amp;amp;lt;?&amp;amp;gt; &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;key&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;int &amp;lt;/span&amp;gt;i = &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;key&amp;lt;/span&amp;gt;.threadLocalHashCode &amp;amp;amp; (&amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;table&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;length &amp;lt;/span&amp;gt;- &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;1&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Entry &amp;lt;/span&amp;gt;e = &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;table&amp;lt;/span&amp;gt;[i];&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;// Android-changed: Use refersTo().&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(e != &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;null &amp;lt;/span&amp;gt;&amp;amp;amp;&amp;amp;amp; e.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;refersTo&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;key&amp;lt;/span&amp;gt;))&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;return &amp;lt;/span&amp;gt;e;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;else&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;        return &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;getEntryAfterMiss&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;key&amp;lt;/span&amp;gt;, i, e);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;}&amp;lt;/pre&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;1862&quot; y=&quot;900&quot; width=&quot;250&quot; height=&quot;80&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;Usvd829vFf0LGTeXWWfx-1&quot; value=&quot;&amp;lt;pre style=&amp;quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;ThreadLocalMap &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239);&amp;quot;&amp;gt;getMap&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;Thread &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;t&amp;lt;/span&amp;gt;) {&amp;lt;br&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;return &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;t&amp;lt;/span&amp;gt;.threadLocals;&amp;lt;br&amp;gt;}&amp;lt;/pre&amp;gt;&amp;lt;pre style=&amp;quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&amp;quot;&amp;gt;&amp;lt;pre&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;void &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239);&amp;quot;&amp;gt;createMap&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;Thread &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;t&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;T &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;firstValue&amp;lt;/span&amp;gt;) {&amp;lt;br&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;t&amp;lt;/span&amp;gt;.threadLocals = &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;new &amp;lt;br/&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;ThreadLocalMap&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;this&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;firstValue&amp;lt;/span&amp;gt;);&amp;lt;br&amp;gt;}&amp;lt;/pre&amp;gt;&amp;lt;/pre&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#000000;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;1722&quot; y=&quot;467&quot; width=&quot;180&quot; height=&quot;70&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;Usvd829vFf0LGTeXWWfx-3&quot; value=&quot;&amp;lt;pre style=&amp;quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;ThreadLocalMap&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;ThreadLocal&amp;lt;/span&amp;gt;&amp;amp;lt;?&amp;amp;gt; &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;firstKey&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Object &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;firstValue&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;table &amp;lt;/span&amp;gt;= &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;new &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Entry&amp;lt;/span&amp;gt;[&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;INITIAL_CAPACITY&amp;lt;/span&amp;gt;];&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;int &amp;lt;/span&amp;gt;i = &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;firstKey&amp;lt;/span&amp;gt;.threadLocalHashCode &amp;amp;amp; (&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;INITIAL_CAPACITY &amp;lt;/span&amp;gt;- &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;1&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;table&amp;lt;/span&amp;gt;[i] = &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;new &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Entry&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;firstKey&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;firstValue&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;size &amp;lt;/span&amp;gt;= &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;1&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;setThreshold&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;INITIAL_CAPACITY&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;}&amp;lt;br/&amp;gt;&amp;lt;pre&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;private void &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239);&amp;quot;&amp;gt;setThreshold&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;int &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;len&amp;lt;/span&amp;gt;) {&amp;lt;br&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111);&amp;quot;&amp;gt;threshold &amp;lt;/span&amp;gt;= &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;len &amp;lt;/span&amp;gt;* &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;2 &amp;lt;/span&amp;gt;/ &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;3&amp;lt;/span&amp;gt;;&amp;lt;br&amp;gt;}&amp;lt;/pre&amp;gt;&amp;lt;br/&amp;gt;&amp;lt;/pre&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2112&quot; y=&quot;631&quot; width=&quot;290&quot; height=&quot;100&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;Usvd829vFf0LGTeXWWfx-7&quot; value=&quot;&amp;lt;div style=&amp;quot;font-size: 8px;&amp;quot;&amp;gt;ThreadLocal对象进行set(T)的时候，会获取当前线程中的ThreadLocalMap对象；然后将数据存放在ThreadLocalMap中。&amp;lt;/div&amp;gt;每个线程都有一个ThreadLocalMap，里面存放的数据是Entry数组，每个Entry是以ThreadLocal为key，T为value进行存储；&quot; style=&quot;whiteSpace=wrap;html=1;align=left;fontSize=8;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;1962&quot; y=&quot;232&quot; width=&quot;270&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;YRkNxRZ61KOj2W9NJHFv-2&quot; value=&quot;&amp;lt;pre style=&amp;quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;private static int &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;nextIndex&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;int &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;i&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;int &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;len&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;return &amp;lt;/span&amp;gt;((&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;i &amp;lt;/span&amp;gt;+ &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;1 &amp;lt;/span&amp;gt;&amp;amp;lt; &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;len&amp;lt;/span&amp;gt;) ? &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;i &amp;lt;/span&amp;gt;+ &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;1 &amp;lt;/span&amp;gt;: &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;0&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;}&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;private static int &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;prevIndex&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;int &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;i&amp;lt;/span&amp;gt;, &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;int &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;len&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;return &amp;lt;/span&amp;gt;((&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;i &amp;lt;/span&amp;gt;- &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;1 &amp;lt;/span&amp;gt;&amp;amp;gt;= &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;0&amp;lt;/span&amp;gt;) ? &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;i &amp;lt;/span&amp;gt;- &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;1 &amp;lt;/span&amp;gt;: &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;len &amp;lt;/span&amp;gt;- &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;1&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;}&amp;lt;/pre&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;1693&quot; y=&quot;726&quot; width=&quot;170&quot; height=&quot;80&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;YRkNxRZ61KOj2W9NJHFv-4&quot; value=&quot;&amp;lt;pre style=&amp;quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;private void &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;rehash&amp;lt;/span&amp;gt;() {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;expungeStaleEntries&amp;lt;/span&amp;gt;();&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;// Use lower threshold for doubling to avoid hysteresis&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;size &amp;lt;/span&amp;gt;&amp;amp;gt;= &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;threshold &amp;lt;/span&amp;gt;- &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;threshold &amp;lt;/span&amp;gt;/ &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;4&amp;lt;/span&amp;gt;)&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;resize&amp;lt;/span&amp;gt;();&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;}&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;/**&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt; * Double the capacity of the table.&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt; */&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;private void &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;resize&amp;lt;/span&amp;gt;() {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Entry&amp;lt;/span&amp;gt;[] oldTab = &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;table&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;int &amp;lt;/span&amp;gt;oldLen = oldTab.&amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;length&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;int &amp;lt;/span&amp;gt;newLen = oldLen * &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;2&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Entry&amp;lt;/span&amp;gt;[] newTab = &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;new &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Entry&amp;lt;/span&amp;gt;[newLen];&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;int &amp;lt;/span&amp;gt;count = &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;0&amp;lt;/span&amp;gt;;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;for &amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;int &amp;lt;/span&amp;gt;j = &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;0&amp;lt;/span&amp;gt;; j &amp;amp;lt; oldLen; ++j) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Entry &amp;lt;/span&amp;gt;e = oldTab[j];&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(e != &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;null&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;ThreadLocal&amp;lt;/span&amp;gt;&amp;amp;lt;?&amp;amp;gt; k = e.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;get&amp;lt;/span&amp;gt;();&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(k == &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;null&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;                e.&amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;value &amp;lt;/span&amp;gt;= &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;null&amp;lt;/span&amp;gt;; &amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;// Help the GC&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;            &amp;lt;/span&amp;gt;} &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;else &amp;lt;/span&amp;gt;{&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;                &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;int &amp;lt;/span&amp;gt;h = k.threadLocalHashCode &amp;amp;amp; (newLen - &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;1&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;                &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;while &amp;lt;/span&amp;gt;(newTab[h] != &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;null&amp;lt;/span&amp;gt;)&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;                    h = &amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;nextIndex&amp;lt;/span&amp;gt;(h, newLen);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;                newTab[h] = e;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;                count++;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;            }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;setThreshold&amp;lt;/span&amp;gt;(newLen);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;size &amp;lt;/span&amp;gt;= count;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(239, 89, 111); font-size: 6px;&amp;quot;&amp;gt;table &amp;lt;/span&amp;gt;= newTab;&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;}&amp;lt;/pre&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2111&quot; y=&quot;859&quot; width=&quot;260&quot; height=&quot;310&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;YRkNxRZ61KOj2W9NJHFv-7&quot; value=&quot;Thread&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2020&quot; y=&quot;40&quot; width=&quot;180&quot; height=&quot;52&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;YRkNxRZ61KOj2W9NJHFv-8&quot; value=&quot;+ threadLocals: ThreadLocal.ThreadLocalMap&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;YRkNxRZ61KOj2W9NJHFv-7&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;26&quot; width=&quot;180&quot; height=&quot;26&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;YRkNxRZ61KOj2W9NJHFv-11&quot; value=&quot;&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=0;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2240&quot; y=&quot;70&quot; width=&quot;152&quot; height=&quot;208&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxRectangle x=&quot;1170&quot; y=&quot;410&quot; width=&quot;50&quot; height=&quot;40&quot; as=&quot;alternateBounds&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;YRkNxRZ61KOj2W9NJHFv-16&quot; value=&quot;entry: Entry --&amp;amp;gt; (ThreadLocal, Tvalue)&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;YRkNxRZ61KOj2W9NJHFv-11&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry width=&quot;152&quot; height=&quot;26&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;YRkNxRZ61KOj2W9NJHFv-18&quot; value=&quot;entry1: Entry&amp;amp;nbsp;--&amp;amp;gt; (ThreadLocal, Tvalue)&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;YRkNxRZ61KOj2W9NJHFv-11&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;26&quot; width=&quot;152&quot; height=&quot;26&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;YRkNxRZ61KOj2W9NJHFv-19&quot; value=&quot;entry2: Entry&amp;amp;nbsp;--&amp;amp;gt; (ThreadLocal, Tvalue)&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;YRkNxRZ61KOj2W9NJHFv-11&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;52&quot; width=&quot;152&quot; height=&quot;26&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;YRkNxRZ61KOj2W9NJHFv-21&quot; value=&quot;entry3: Entry&amp;amp;nbsp;--&amp;amp;gt; (ThreadLocal, Tvalue)&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;YRkNxRZ61KOj2W9NJHFv-11&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;78&quot; width=&quot;152&quot; height=&quot;26&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;YRkNxRZ61KOj2W9NJHFv-23&quot; value=&quot;entry4: Entry&amp;amp;nbsp;--&amp;amp;gt; (ThreadLocal, Tvalue)&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;YRkNxRZ61KOj2W9NJHFv-11&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;104&quot; width=&quot;152&quot; height=&quot;26&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;YRkNxRZ61KOj2W9NJHFv-24&quot; value=&quot;entry5: Entry&amp;amp;nbsp;--&amp;amp;gt; (ThreadLocal, Tvalue)&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;YRkNxRZ61KOj2W9NJHFv-11&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;130&quot; width=&quot;152&quot; height=&quot;26&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;YRkNxRZ61KOj2W9NJHFv-25&quot; value=&quot;entry6: Entry&amp;amp;nbsp;--&amp;amp;gt; (ThreadLocal, Tvalue)&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;YRkNxRZ61KOj2W9NJHFv-11&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;156&quot; width=&quot;152&quot; height=&quot;26&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;YRkNxRZ61KOj2W9NJHFv-26&quot; value=&quot;......&quot; style=&quot;text;strokeColor=none;fillColor=none;align=center;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;&quot; parent=&quot;YRkNxRZ61KOj2W9NJHFv-11&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;182&quot; width=&quot;152&quot; height=&quot;26&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;YRkNxRZ61KOj2W9NJHFv-28&quot; value=&quot;&quot; style=&quot;endArrow=open;endFill=1;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=-0.019;entryY=0.33;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=8;&quot; parent=&quot;1&quot; source=&quot;YRkNxRZ61KOj2W9NJHFv-8&quot; target=&quot;YRkNxRZ61KOj2W9NJHFv-16&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry width=&quot;160&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;2232&quot; y=&quot;270&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;2392&quot; y=&quot;270&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fzmKr-huMYEFjz7aQjL3-1&quot; value=&quot;&amp;lt;pre style=&amp;quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&amp;quot;&amp;gt;&amp;lt;pre&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;static final &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;ThreadLocal&amp;lt;/span&amp;gt;&amp;amp;lt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;Looper&amp;lt;/span&amp;gt;&amp;amp;gt; &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;sThreadLocal &amp;lt;/span&amp;gt;= &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;new &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;ThreadLocal&amp;lt;/span&amp;gt;&amp;amp;lt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;Looper&amp;lt;/span&amp;gt;&amp;amp;gt;();&amp;lt;/pre&amp;gt;&amp;lt;/pre&amp;gt;&amp;lt;pre style=&amp;quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;private static void &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;prepare&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;boolean &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;quitAllowed&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;if &amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;sThreadLocal&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;get&amp;lt;/span&amp;gt;() != &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;null&amp;lt;/span&amp;gt;) {&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;        &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;throw new &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;RuntimeException&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(137, 202, 120); font-size: 6px;&amp;quot;&amp;gt;&amp;quot;Only one Looper may be created per thread&amp;quot;&amp;lt;/span&amp;gt;);&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    }&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;sThreadLocal&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239); font-size: 6px;&amp;quot;&amp;gt;set&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&amp;quot;&amp;gt;new &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-size: 6px;&amp;quot;&amp;gt;Looper&amp;lt;/span&amp;gt;(&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102); font-size: 6px;&amp;quot;&amp;gt;quitAllowed&amp;lt;/span&amp;gt;));&amp;lt;br style=&amp;quot;font-size: 6px;&amp;quot;&amp;gt;}&amp;lt;br/&amp;gt;&amp;lt;pre&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;public static &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123); font-style: italic;&amp;quot;&amp;gt;@Nullable &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(229, 192, 123);&amp;quot;&amp;gt;Looper &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239);&amp;quot;&amp;gt;myLooper&amp;lt;/span&amp;gt;() {&amp;lt;br&amp;gt;    &amp;lt;span style=&amp;quot;color: rgb(213, 95, 222); font-style: italic;&amp;quot;&amp;gt;return &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(209, 154, 102);&amp;quot;&amp;gt;sThreadLocal&amp;lt;/span&amp;gt;.&amp;lt;span style=&amp;quot;color: rgb(97, 175, 239);&amp;quot;&amp;gt;get&amp;lt;/span&amp;gt;();&amp;lt;br&amp;gt;}&amp;lt;/pre&amp;gt;&amp;lt;br/&amp;gt;&amp;lt;/pre&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2112&quot; y=&quot;450&quot; width=&quot;330&quot; height=&quot;100&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;cZl-_tYypcyyZDHa4Ti2-1&quot; value=&quot;ThreadLocal 类的使用方法，以Android中Looper举例&quot; style=&quot;text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FF0000;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;2112&quot; y=&quot;422&quot; width=&quot;300&quot; height=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uK6GI_ooJPnrXkrZsftc-3&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;&quot; parent=&quot;1&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;1914&quot; y=&quot;481&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;1844&quot; y=&quot;481&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uK6GI_ooJPnrXkrZsftc-5&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;&quot; parent=&quot;1&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;1929&quot; y=&quot;510.71&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;1869&quot; y=&quot;510.71&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uK6GI_ooJPnrXkrZsftc-6&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;&quot; parent=&quot;1&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;2125&quot; y=&quot;506&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;2037&quot; y=&quot;466&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uK6GI_ooJPnrXkrZsftc-7&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;&quot; parent=&quot;1&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;2128&quot; y=&quot;536&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;1958&quot; y=&quot;528&quot; as=&quot;targetPoint&quot; /&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;2038&quot; y=&quot;528&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uK6GI_ooJPnrXkrZsftc-10&quot; value=&quot;&quot; style=&quot;curved=1;endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;&quot; parent=&quot;1&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;1951.62&quot; y=&quot;501&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;1921.62&quot; y=&quot;641&quot; as=&quot;targetPoint&quot; /&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;2090.37&quot; y=&quot;491&quot; /&gt;&#10;              &lt;mxPoint x=&quot;2090.37&quot; y=&quot;611&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uK6GI_ooJPnrXkrZsftc-11&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;&quot; parent=&quot;1&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;1922&quot; y=&quot;877&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;2112&quot; y=&quot;877&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;      &lt;/root&gt;&#10;    &lt;/mxGraphModel&gt;&#10;  &lt;/diagram&gt;&#10;&lt;/mxfile&gt;&#10;"><defs/><g><g><path d="M 1030 85 L 1030 105 L 1030 117.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1030 122.88 L 1026.5 115.88 L 1030 117.63 L 1033.5 115.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="970" y="45" width="120" height="40" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 65px; margin-left: 971px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style="font-size: 8px; text-align: left;">发送消息</pre></div></div></div></foreignObject><text x="1030" y="69" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">发送消息</text></switch></g></g><g><rect x="1170" y="40" width="210" height="44" fill="#000000" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 208px; height: 1px; padding-top: 47px; margin-left: 1172px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 6px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style="font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; font-size: 6px; text-align: left; color: rgb(187, 187, 187);"><pre style="font-size: 6px;"><span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">public final boolean </span><span style="color: rgb(97, 175, 239); font-size: 6px;">sendMessage</span>(<span style="color: rgb(229, 192, 123); font-style: italic; font-size: 6px;">@NonNull </span><span style="color: rgb(229, 192, 123); font-size: 6px;">Message </span><span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>) {<br style="font-size: 6px;" />    <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">return </span><span style="color: rgb(97, 175, 239); font-size: 6px;">sendMessageDelayed</span>(<span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>, <span style="color: rgb(209, 154, 102); font-size: 6px;">0</span>);<br style="font-size: 6px;" />}</pre></pre></div></div></div></foreignObject><text x="1172" y="53" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="6px">public final boolean sendMessage(@NonNull Message msg) {...</text></switch></g></g><g><path d="M 1030 164 L 1030 184 L 1030 164 L 1030 177.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1030 182.88 L 1026.5 175.88 L 1030 177.63 L 1033.5 175.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="970" y="124" width="120" height="40" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 144px; margin-left: 971px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style="font-size: 8px; text-align: left;">发送延时消息</pre></div></div></div></foreignObject><text x="1030" y="148" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">发送延时消息</text></switch></g></g><g><rect x="1170" y="94" width="310" height="120" fill="#000000" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 308px; height: 1px; padding-top: 101px; margin-left: 1172px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 6px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style="color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">public final boolean </span><span style="color: rgb(97, 175, 239); font-size: 6px;">sendMessageDelayed</span>(<span style="color: rgb(229, 192, 123); font-style: italic; font-size: 6px;">@NonNull </span><span style="color: rgb(229, 192, 123); font-size: 6px;">Message </span><span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>, <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">long </span><span style="color: rgb(209, 154, 102); font-size: 6px;">delayMillis</span>) {<br style="font-size: 6px;" />    <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">if </span>(<span style="color: rgb(209, 154, 102); font-size: 6px;">delayMillis </span>&lt; <span style="color: rgb(209, 154, 102); font-size: 6px;">0</span>) {<br style="font-size: 6px;" />        <span style="color: rgb(209, 154, 102); font-size: 6px;">delayMillis </span>= <span style="color: rgb(209, 154, 102); font-size: 6px;">0</span>;<br style="font-size: 6px;" />    }<br style="font-size: 6px;" />    <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">return </span><span style="color: rgb(97, 175, 239); font-size: 6px;">sendMessageAtTime</span>(<span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>, <span style="color: rgb(229, 192, 123); font-size: 6px;">SystemClock</span>.<span style="color: rgb(97, 175, 239); font-size: 6px;">uptimeMillis</span>() + <span style="color: rgb(209, 154, 102); font-size: 6px;">delayMillis</span>);<br style="font-size: 6px;" />}<br style="font-size: 6px;" /><pre style="font-size: 6px;"><span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">public boolean </span><span style="color: rgb(97, 175, 239); font-size: 6px;">sendMessageAtTime</span>(<span style="color: rgb(229, 192, 123); font-style: italic; font-size: 6px;">@NonNull </span><span style="color: rgb(229, 192, 123); font-size: 6px;">Message </span><span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>, <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">long </span><span style="color: rgb(209, 154, 102); font-size: 6px;">uptimeMillis</span>) {<br style="font-size: 6px;" />    <span style="color: rgb(229, 192, 123); font-size: 6px;">MessageQueue </span>queue = <span style="color: rgb(239, 89, 111); font-size: 6px;">mQueue</span>;<br style="font-size: 6px;" />    <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">if </span>(queue == <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">null</span>) {<br style="font-size: 6px;" />        <span style="color: rgb(229, 192, 123); font-size: 6px;">Log</span>.<span style="color: rgb(97, 175, 239); font-size: 6px;">w</span>(<span style="color: rgb(137, 202, 120); font-size: 6px;">"Looper"</span>, "sendMessageAtTime() called with no mQueue", e);<br />        <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">return false</span>;<br style="font-size: 6px;" />    }<br style="font-size: 6px;" />    <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">return </span><span style="color: rgb(97, 175, 239); font-size: 6px;">enqueueMessage</span>(queue, <span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>, <span style="color: rgb(209, 154, 102); font-size: 6px;">uptimeMillis</span>);<br style="font-size: 6px;" />}</pre><br style="font-size: 6px;" /></pre></div></div></div></foreignObject><text x="1172" y="107" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="6px">public final boolean sendMessageDelayed(@NonNull Message msg, long delayMillis) {...</text></switch></g></g><g><path d="M 341 26 L 341 0 L 650 0 L 650 26" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 341 26 L 341 110 L 650 110 L 650 26" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 341 26 L 650 26" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 307px; height: 1px; padding-top: 7px; margin-left: 342px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 8px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">Handler</div></div></div></foreignObject><text x="496" y="15" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="8px" text-anchor="middle" font-weight="bold">Handler</text></switch></g></g><g><rect x="341" y="26" width="309" height="34" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 299px; height: 1px; padding-top: 33px; margin-left: 347px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 30px; overflow: hidden;"><div style="display: inline-block; font-size: 8px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">+ mLooper:Looper<div style="font-size: 8px;">+ mQueue:MessageQueue</div></div></div></div></foreignObject><text x="347" y="41" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="8px">+ mLooper:Looper...</text></switch></g></g><g><path d="M 341 64 L 650 64" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="341" y="68" width="309" height="42" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 299px; height: 1px; padding-top: 75px; margin-left: 347px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 38px; overflow: hidden;"><div style="display: inline-block; font-size: 8px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">+ <span style="font-size: 8px; background-color: initial;">sendMessageAtTime</span><span style="font-size: 8px; background-color: initial;">(</span><span style="font-size: 8px; background-color: initial; font-style: italic;">@NonNull </span><span style="font-size: 8px; background-color: initial;">Message </span><span style="font-size: 8px; background-color: initial;">msg</span><span style="font-size: 8px; background-color: initial;">, </span><span style="font-size: 8px; background-color: initial; font-style: italic;">long </span><span style="font-size: 8px; background-color: initial;">uptimeMillis</span><span style="font-size: 8px; background-color: initial;">)</span><span style="background-color: initial; font-size: 8px;">: </span><span style="font-style: italic; font-size: 8px; background-color: initial;">boolean </span><div style="font-size: 8px;">+ <span style="font-size: 8px; background-color: initial;">enqueueMessage</span><span style="font-size: 8px; background-color: initial;">(</span><span style="font-size: 8px; background-color: initial; font-style: italic;">@NonNull </span><span style="font-size: 8px; background-color: initial;">MessageQueue </span><span style="font-size: 8px; background-color: initial;">queue</span><span style="font-size: 8px; background-color: initial;">, </span><span style="font-size: 8px; background-color: initial; font-style: italic;">@NonNull </span><span style="font-size: 8px; background-color: initial;">Message </span><span style="font-size: 8px; background-color: initial;">msg</span><span style="font-size: 8px; background-color: initial;">,</span><span style="font-size: 8px; background-color: initial; font-style: italic;">long </span><span style="font-size: 8px; background-color: initial;">uptimeMillis</span><span style="font-size: 8px; background-color: initial;">)</span><span style="background-color: initial; font-size: 8px;">: </span><span style="background-color: initial; font-style: italic; font-size: 8px;">boolean </span><br style="font-size: 8px;" /></div></div></div></div></foreignObject><text x="347" y="83" fill="#000000" font-family="Helvetica" font-size="8px">+ sendMessageAtTime(@NonNull Message msg, long uptimeMillis): boolean...</text></switch></g></g><g><path d="M 1030 224 L 1030 244 L 1030 256.38" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1030 261.63 L 1026.5 254.63 L 1030 256.38 L 1033.5 254.63 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 255px; margin-left: 1033px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">调用MessageQueue类的入队方法</div></div></div></foreignObject><text x="1033" y="258" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">调用MessageQueue类的入队方法</text></switch></g></g><g><rect x="970" y="184" width="120" height="40" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 204px; margin-left: 971px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style="font-size: 8px; text-align: left;">消息入队</pre></div></div></div></foreignObject><text x="1030" y="208" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">消息入队</text></switch></g></g><g><rect x="1170" y="213" width="310" height="91" fill="#000000" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 308px; height: 1px; padding-top: 220px; margin-left: 1172px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 6px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style="color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">private boolean </span><span style="color: rgb(97, 175, 239); font-size: 6px;">enqueueMessage</span>(<span style="color: rgb(229, 192, 123); font-style: italic; font-size: 6px;">@NonNull </span><span style="color: rgb(229, 192, 123); font-size: 6px;">MessageQueue </span><span style="color: rgb(209, 154, 102); font-size: 6px;">queue</span>, <span style="color: rgb(229, 192, 123); font-style: italic; font-size: 6px;">@NonNull </span><span style="color: rgb(229, 192, 123); font-size: 6px;">Message </span><span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>,<br style="font-size: 6px;" />        <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">long </span><span style="color: rgb(209, 154, 102); font-size: 6px;">uptimeMillis</span>) {<br style="font-size: 6px;" />    <span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>.target = <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">this</span>;<br style="font-size: 6px;" />    <span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>.workSourceUid = <span style="color: rgb(229, 192, 123); font-size: 6px;">ThreadLocalWorkSource</span>.<span style="color: rgb(97, 175, 239); font-size: 6px;">getUid</span>();<br style="font-size: 6px;" /><br style="font-size: 6px;" />    <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">if </span>(<span style="color: rgb(239, 89, 111); font-size: 6px;">mAsynchronous</span>) {<br style="font-size: 6px;" />        <span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>.<span style="color: rgb(97, 175, 239); font-size: 6px;">setAsynchronous</span>(<span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">true</span>);<br style="font-size: 6px;" />    }<br style="font-size: 6px;" />    <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">return </span><span style="color: rgb(209, 154, 102); font-size: 6px;">queue</span>.enqueueMessage(<span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>, <span style="color: rgb(209, 154, 102); font-size: 6px;">uptimeMillis</span>);<br style="font-size: 6px;" />}</pre></div></div></div></foreignObject><text x="1172" y="226" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="6px">private boolean enqueueMessage(@NonNull MessageQueue queue, @NonNull Message msg,...</text></switch></g></g><g><path d="M 1030 282.75 L 1030 302.8 L 1030 284 L 1030 297.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1030 302.88 L 1026.5 295.88 L 1030 297.63 L 1033.5 295.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="970" y="262.75" width="120" height="20" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 273px; margin-left: 971px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style="font-size: 8px; text-align: left;">消息入队</pre></div></div></div></foreignObject><text x="1030" y="276" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">消息入队</text></switch></g></g><a xlink:href="https://app.diagrams.net/&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 20px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;enqueueMessage&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Message &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;, &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;when&lt;/span&gt;) {&lt;br&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.target == &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;null&lt;/span&gt;) {&lt;br&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;IllegalArgumentException&lt;/span&gt;(&lt;span style=&quot;color: rgb(137, 202, 120);&quot;&gt;&quot;Message must have a target.&quot;&lt;/span&gt;);&lt;br&gt;    }&lt;br&gt;&lt;br&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;synchronized &lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;this&lt;/span&gt;) {&lt;br&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.isInUse()) {&lt;br&gt;            &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;IllegalStateException&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg &lt;/span&gt;+ &lt;span style=&quot;color: rgb(137, 202, 120);&quot;&gt;&quot; This message is already in use.&quot;&lt;/span&gt;);&lt;br&gt;        }&lt;br&gt;&lt;br&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;color: rgb(239, 89, 111);&quot;&gt;mQuitting&lt;/span&gt;) {&lt;br&gt;            &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;IllegalStateException &lt;/span&gt;e = &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;IllegalStateException&lt;/span&gt;(&lt;br&gt;                    &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.target + &lt;span style=&quot;color: rgb(137, 202, 120);&quot;&gt;&quot; sending message to a Handler on a dead thread&quot;&lt;/span&gt;);&lt;br&gt;            &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Log&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;w&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;TAG&lt;/span&gt;, e.&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;getMessage&lt;/span&gt;(), e);&lt;br&gt;            &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;recycle&lt;/span&gt;();&lt;br&gt;            &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;return false&lt;/span&gt;;&lt;br&gt;        }&lt;br&gt;&lt;br&gt;        &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.markInUse();&lt;br&gt;        &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.when = &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;when&lt;/span&gt;;&lt;br&gt;        &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Message &lt;/span&gt;p = &lt;span style=&quot;color: rgb(239, 89, 111);&quot;&gt;mMessages&lt;/span&gt;;&lt;br&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;boolean &lt;/span&gt;needWake;&lt;br&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(p == &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;null &lt;/span&gt;|| &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;when &lt;/span&gt;== &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0 &lt;/span&gt;|| &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;when &lt;/span&gt;&amp;lt; p.when) {&lt;br&gt;            &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;// New head, wake up the event queue if blocked.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.next = p;&lt;br&gt;            &lt;span style=&quot;color: rgb(239, 89, 111);&quot;&gt;mMessages &lt;/span&gt;= &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;;&lt;br&gt;            needWake = &lt;span style=&quot;color: rgb(239, 89, 111);&quot;&gt;mBlocked&lt;/span&gt;;&lt;br&gt;        } &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;else &lt;/span&gt;{&lt;br&gt;            &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;// Inserted within the middle of the queue.  Usually we don't have to wake&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;            // up the event queue unless there is a barrier at the head of the queue&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;            // and the message is the earliest asynchronous message in the queue.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;            &lt;/span&gt;needWake = &lt;span style=&quot;color: rgb(239, 89, 111);&quot;&gt;mBlocked &lt;/span&gt;&amp;amp;&amp;amp; p.target == &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;null &lt;/span&gt;&amp;amp;&amp;amp; &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;isAsynchronous&lt;/span&gt;();&lt;br&gt;            &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Message &lt;/span&gt;prev;&lt;br&gt;            &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;for &lt;/span&gt;(;;) {&lt;br&gt;                prev = p;&lt;br&gt;                p = p.next;&lt;br&gt;                &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(p == &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;null &lt;/span&gt;|| &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;when &lt;/span&gt;&amp;lt; p.when) {&lt;br&gt;                    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;break&lt;/span&gt;;&lt;br&gt;                }&lt;br&gt;                &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(needWake &amp;amp;&amp;amp; p.&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;isAsynchronous&lt;/span&gt;()) {&lt;br&gt;                    needWake = &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;false&lt;/span&gt;;&lt;br&gt;                }&lt;br&gt;            }&lt;br&gt;            &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.next = p; &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;// invariant: p == prev.next&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;            &lt;/span&gt;prev.next = &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;;&lt;br&gt;        }&lt;br&gt;&lt;br&gt;        &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;// We can assume mPtr != 0 because mQuitting is false.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(needWake) {&lt;br&gt;            &lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;nativeWake&lt;/span&gt;(&lt;span style=&quot;color: rgb(239, 89, 111);&quot;&gt;mPtr&lt;/span&gt;);&lt;br&gt;        }&lt;br&gt;    }&lt;br&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;return true&lt;/span&gt;;&lt;br&gt;}&lt;/pre&gt;"><g><rect x="1170" y="304" width="320" height="410" fill="#000000" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 318px; height: 1px; padding-top: 311px; margin-left: 1172px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 6px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style="color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">boolean </span><span style="color: rgb(97, 175, 239); font-size: 6px;">enqueueMessage</span>(<span style="color: rgb(229, 192, 123); font-size: 6px;">Message </span><span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>, <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">long </span><span style="color: rgb(209, 154, 102); font-size: 6px;">when</span>) {<br style="font-size: 6px;" />    <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">if </span>(<span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>.target == <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">null</span>) {<br style="font-size: 6px;" />        <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">throw new </span><span style="color: rgb(229, 192, 123); font-size: 6px;">IllegalArgumentException</span>(<span style="color: rgb(137, 202, 120); font-size: 6px;">"Message must have a target."</span>);<br style="font-size: 6px;" />    }<br style="font-size: 6px;" /><br style="font-size: 6px;" />    <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">synchronized </span>(<span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">this</span>) {<br style="font-size: 6px;" />        <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">if </span>(<span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>.isInUse()) {<br style="font-size: 6px;" />            <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">throw new </span><span style="color: rgb(229, 192, 123); font-size: 6px;">IllegalStateException</span>(<span style="color: rgb(209, 154, 102); font-size: 6px;">msg </span>+ <span style="color: rgb(137, 202, 120); font-size: 6px;">" This message is already in use."</span>);<br style="font-size: 6px;" />        }<br style="font-size: 6px;" /><br style="font-size: 6px;" />        <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">if </span>(<span style="color: rgb(239, 89, 111); font-size: 6px;">mQuitting</span>) {<br style="font-size: 6px;" />            <span style="color: rgb(229, 192, 123); font-size: 6px;">IllegalStateException </span>e = <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">new </span><span style="color: rgb(229, 192, 123); font-size: 6px;">IllegalStateException</span>(<br style="font-size: 6px;" />                    <span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>.target + <span style="color: rgb(137, 202, 120); font-size: 6px;">" sending message to a Handler on a dead thread"</span>);<br style="font-size: 6px;" />            <span style="color: rgb(229, 192, 123); font-size: 6px;">Log</span>.<span style="color: rgb(97, 175, 239); font-size: 6px;">w</span>(<span style="color: rgb(209, 154, 102); font-size: 6px;">TAG</span>, e.<span style="color: rgb(97, 175, 239); font-size: 6px;">getMessage</span>(), e);<br style="font-size: 6px;" />            <span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>.<span style="color: rgb(97, 175, 239); font-size: 6px;">recycle</span>();<br style="font-size: 6px;" />            <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">return false</span>;<br style="font-size: 6px;" />        }<br style="font-size: 6px;" /><br style="font-size: 6px;" />        <span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>.markInUse();<br style="font-size: 6px;" />        <span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>.when = <span style="color: rgb(209, 154, 102); font-size: 6px;">when</span>;<br style="font-size: 6px;" />        <span style="color: rgb(229, 192, 123); font-size: 6px;">Message </span>p = <span style="color: rgb(239, 89, 111); font-size: 6px;">mMessages</span>;<br style="font-size: 6px;" />        <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">boolean </span>needWake;<br style="font-size: 6px;" />        <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">if </span>(p == <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">null </span>|| <span style="color: rgb(209, 154, 102); font-size: 6px;">when </span>== <span style="color: rgb(209, 154, 102); font-size: 6px;">0 </span>|| <span style="color: rgb(209, 154, 102); font-size: 6px;">when </span>&lt; p.when) {<br style="font-size: 6px;" />            <span style="color: rgb(92, 99, 112); font-style: italic; font-size: 6px;">// New head, wake up the event queue if blocked.<br style="font-size: 6px;" /></span><span style="color: rgb(92, 99, 112); font-style: italic; font-size: 6px;">            </span><span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>.next = p;<br style="font-size: 6px;" />            <span style="color: rgb(239, 89, 111); font-size: 6px;">mMessages </span>= <span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>;<br style="font-size: 6px;" />            needWake = <span style="color: rgb(239, 89, 111); font-size: 6px;">mBlocked</span>;<br style="font-size: 6px;" />        } <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">else </span>{<br style="font-size: 6px;" />            <span style="color: rgb(92, 99, 112); font-style: italic; font-size: 6px;">// Inserted within the middle of the queue.  Usually we don't have to wake<br style="font-size: 6px;" /></span><span style="color: rgb(92, 99, 112); font-style: italic; font-size: 6px;">            // up the event queue unless there is a barrier at the head of the queue<br style="font-size: 6px;" /></span><span style="color: rgb(92, 99, 112); font-style: italic; font-size: 6px;">            // and the message is the earliest asynchronous message in the queue.<br style="font-size: 6px;" /></span><span style="color: rgb(92, 99, 112); font-style: italic; font-size: 6px;">            </span>needWake = <span style="color: rgb(239, 89, 111); font-size: 6px;">mBlocked </span>&amp;&amp; p.target == <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">null </span>&amp;&amp; <span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>.<span style="color: rgb(97, 175, 239); font-size: 6px;">isAsynchronous</span>();<br style="font-size: 6px;" />            <span style="color: rgb(229, 192, 123); font-size: 6px;">Message </span>prev;<br style="font-size: 6px;" />            <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">for </span>(;;) {<br style="font-size: 6px;" />                prev = p;<br style="font-size: 6px;" />                p = p.next;<br style="font-size: 6px;" />                <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">if </span>(p == <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">null </span>|| <span style="color: rgb(209, 154, 102); font-size: 6px;">when </span>&lt; p.when) {<br style="font-size: 6px;" />                    <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">break</span>;<br style="font-size: 6px;" />                }<br style="font-size: 6px;" />                <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">if </span>(needWake &amp;&amp; p.<span style="color: rgb(97, 175, 239); font-size: 6px;">isAsynchronous</span>()) {<br style="font-size: 6px;" />                    needWake = <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">false</span>;<br style="font-size: 6px;" />                }<br style="font-size: 6px;" />            }<br style="font-size: 6px;" />            <span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>.next = p; <span style="color: rgb(92, 99, 112); font-style: italic; font-size: 6px;">// invariant: p == prev.next<br style="font-size: 6px;" /></span><span style="color: rgb(92, 99, 112); font-style: italic; font-size: 6px;">            </span>prev.next = <span style="color: rgb(209, 154, 102); font-size: 6px;">msg</span>;<br style="font-size: 6px;" />        }<br style="font-size: 6px;" /><br style="font-size: 6px;" />        <span style="color: rgb(92, 99, 112); font-style: italic; font-size: 6px;">// We can assume mPtr != 0 because mQuitting is false.<br style="font-size: 6px;" /></span><span style="color: rgb(92, 99, 112); font-style: italic; font-size: 6px;">        </span><span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">if </span>(needWake) {<br style="font-size: 6px;" />            <span style="color: rgb(97, 175, 239); font-size: 6px;">nativeWake</span>(<span style="color: rgb(239, 89, 111); font-size: 6px;">mPtr</span>);<br style="font-size: 6px;" />        }<br style="font-size: 6px;" />    }<br style="font-size: 6px;" />    <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">return true</span>;<br style="font-size: 6px;" />}</pre></div></div></div></foreignObject><text x="1172" y="317" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="6px">boolean enqueueMessage(Message msg, long when) {...</text></switch></g></g></a><g><path d="M 990 344 L 936.37 344" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 931.12 344 L 938.12 340.5 L 936.37 344 L 938.12 347.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 345px; margin-left: 963px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">否</div></div></div></foreignObject><text x="963" y="348" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">否</text></switch></g></g><g><path d="M 1030 384 L 1030 404 L 1030 399 L 1030 412.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1030 417.88 L 1026.5 410.88 L 1030 412.63 L 1033.5 410.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 403px; margin-left: 1032px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">是</div></div></div></foreignObject><text x="1032" y="406" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">是</text></switch></g></g><g><path d="M 1030 304 L 1070 344 L 1030 384 L 990 344 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 344px; margin-left: 991px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 6px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">判断msg是否有对应的handler</div></div></div></foreignObject><text x="1030" y="346" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="6px" text-anchor="middle">判断msg是否有对应的handler</text></switch></g></g><g><rect x="880" y="334" width="50" height="20" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 48px; height: 1px; padding-top: 344px; margin-left: 881px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 6px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">扔异常</div></div></div></foreignObject><text x="905" y="346" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="6px" text-anchor="middle">扔异常</text></switch></g></g><g><path d="M 990 459 L 936.37 459" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 931.12 459 L 938.12 455.5 L 936.37 459 L 938.12 462.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 460px; margin-left: 967px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">是</div></div></div></foreignObject><text x="967" y="463" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">是</text></switch></g></g><g><path d="M 1030 499 L 1030 519 L 1030 510.8 L 1030 524.38" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1030 529.63 L 1026.5 522.63 L 1030 524.38 L 1033.5 522.63 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 518px; margin-left: 1030px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">否</div></div></div></foreignObject><text x="1030" y="521" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">否</text></switch></g></g><g><path d="M 1030 419 L 1070 459 L 1030 499 L 990 459 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 459px; margin-left: 991px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 6px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">判断msg是否已经被使用了</div></div></div></foreignObject><text x="1030" y="461" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="6px" text-anchor="middle">判断msg是否已经被使用了</text></switch></g></g><g><rect x="890" y="449" width="40" height="20" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 459px; margin-left: 891px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 6px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">扔异常</div></div></div></foreignObject><text x="910" y="461" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="6px" text-anchor="middle">扔异常</text></switch></g></g><g><path d="M 990 570.75 L 936.37 570.75" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 931.12 570.75 L 938.12 567.25 L 936.37 570.75 L 938.12 574.25 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 573px; margin-left: 967px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">是</div></div></div></foreignObject><text x="967" y="576" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">是</text></switch></g></g><g><path d="M 1030 610.75 L 1030 684.38" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1030 689.63 L 1026.5 682.63 L 1030 684.38 L 1033.5 682.63 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 634px; margin-left: 1031px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">否</div></div></div></foreignObject><text x="1031" y="637" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">否</text></switch></g></g><g><path d="M 1030 530.75 L 1070 570.75 L 1030 610.75 L 990 570.75 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 571px; margin-left: 991px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 6px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">判断当前handle所在的线程是否正在退出</div></div></div></foreignObject><text x="1030" y="573" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="6px" text-anchor="middle">判断当前handle所在的线程是否正在退出</text></switch></g></g><g><rect x="810" y="555.75" width="120" height="30" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 571px; margin-left: 811px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 6px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">销毁消息，返回false</div></div></div></foreignObject><text x="870" y="573" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="6px" text-anchor="middle">销毁消息，返回false</text></switch></g></g><g><rect x="970" y="419" width="120" height="30" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 434px; margin-left: 1030px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">上锁，同步代码块</div></div></div></foreignObject><text x="1030" y="438" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">上锁，同步代码块</text></switch></g></g><g><path d="M 340 170 L 340 144 L 650 144 L 650 170" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 340 170 L 340 228 L 650 228 L 650 170" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"/><path d="M 340 170 L 650 170" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 308px; height: 1px; padding-top: 151px; margin-left: 341px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 8px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">MessageQueue</div></div></div></foreignObject><text x="495" y="159" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="8px" text-anchor="middle" font-weight="bold">MessageQueue</text></switch></g></g><g><rect x="340" y="170" width="310" height="24" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 300px; height: 1px; padding-top: 177px; margin-left: 346px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 20px; overflow: hidden;"><div style="display: inline-block; font-size: 8px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">+ mMessages: Message<div style="font-size: 8px;"><br style="font-size: 8px;" /></div></div></div></div></foreignObject><text x="346" y="185" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="8px">+ mMessages: Message&#xa;</text></switch></g></g><g><path d="M 340 198 L 650 198" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="340" y="202" width="310" height="26" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 300px; height: 1px; padding-top: 209px; margin-left: 346px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 22px; overflow: hidden;"><div style="display: inline-block; font-size: 8px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">+ enqueueMessage(type): boolean</div></div></div></foreignObject><text x="346" y="217" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="8px">+ enqueueMessage(type): boolean</text></switch></g></g><g><path d="M 341 327 L 341 301 L 650 301 L 650 327" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 341 327 L 341 445 L 650 445 L 650 327" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"/><path d="M 341 327 L 650 327" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 307px; height: 1px; padding-top: 308px; margin-left: 342px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 8px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">Message</div></div></div></foreignObject><text x="496" y="316" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="8px" text-anchor="middle" font-weight="bold">Message</text></switch></g></g><g><rect x="341" y="327" width="309" height="84" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 299px; height: 1px; padding-top: 334px; margin-left: 347px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 80px; overflow: hidden;"><div style="display: inline-block; font-size: 8px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">+ when: long<div style="font-size: 8px;">+ target:Handle<br style="font-size: 8px;" /></div><div style="font-size: 8px;">+ data:Bundle<br style="font-size: 8px;" /></div><div style="font-size: 8px;">+ next: Message     //由此构成消息的单项链表<br style="font-size: 8px;" /></div><div style="font-size: 8px;">+ sPool: Message<br style="font-size: 8px;" /></div><div style="font-size: 8px;">+ sPoolSize: int <br style="font-size: 8px;" /></div><div style="font-size: 8px;">+ MAX_POOL_SIZE: int // 50<br style="font-size: 8px;" /></div></div></div></div></foreignObject><text x="347" y="342" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="8px">+ when: long...</text></switch></g></g><g><path d="M 341 415 L 650 415" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="341" y="419" width="309" height="26" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 299px; height: 1px; padding-top: 426px; margin-left: 347px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 22px; overflow: hidden;"><div style="display: inline-block; font-size: 8px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">+ obtain(): Message</div></div></div></foreignObject><text x="347" y="434" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="8px">+ obtain(): Message</text></switch></g></g><g><path d="M 990 730.75 L 936.37 730.75" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 931.12 730.75 L 938.12 727.25 L 936.37 730.75 L 938.12 734.25 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 732px; margin-left: 961px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">是</div></div></div></foreignObject><text x="961" y="735" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">是</text></switch></g></g><g><path d="M 1030 770.75 L 1030 827.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1030 832.88 L 1026.5 825.88 L 1030 827.63 L 1033.5 825.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 800px; margin-left: 1028px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">否</div></div></div></foreignObject><text x="1028" y="803" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">否</text></switch></g></g><g><path d="M 1030 690.75 L 1070 730.75 L 1030 770.75 L 990 730.75 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 731px; margin-left: 991px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 6px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">判断msg链表是否为空<div>或者插入消息的when==0<br />或者when&lt;p.when</div></div></div></div></foreignObject><text x="1030" y="733" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="6px" text-anchor="middle">判断msg链表是否为空...</text></switch></g></g><g><rect x="810" y="720.75" width="120" height="20" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 731px; margin-left: 811px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 6px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">将消息插在队列头部</div></div></div></foreignObject><text x="870" y="733" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="6px" text-anchor="middle">将消息插在队列头部</text></switch></g></g><g><rect x="970" y="834" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 864px; margin-left: 971px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 6px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">将消息插入消息链表对应的位置</div></div></div></foreignObject><text x="1030" y="866" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="6px" text-anchor="middle">将消息插入消息链表对应的位置</text></switch></g></g><g><path d="M 340 540 L 340 514 L 650 514 L 650 540" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 340 540 L 340 674 L 650 674 L 650 540" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"/><path d="M 340 540 L 650 540" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 308px; height: 1px; padding-top: 521px; margin-left: 341px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 8px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">Looper</div></div></div></foreignObject><text x="495" y="529" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="8px" text-anchor="middle" font-weight="bold">Looper</text></switch></g></g><g><rect x="340" y="540" width="310" height="54" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 300px; height: 1px; padding-top: 547px; margin-left: 346px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 50px; overflow: hidden;"><div style="display: inline-block; font-size: 8px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">+ sThreadLocal: ThreadLocal<div style="font-size: 8px;">+ sMainLooper: Looper<br style="font-size: 8px;" /></div><div style="font-size: 8px;">+ mQueue: MessageQueue<br style="font-size: 8px;" /></div><div style="font-size: 8px;">+ mThread: Thread<br style="font-size: 8px;" /></div></div></div></div></foreignObject><text x="346" y="555" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="8px">+ sThreadLocal: ThreadLocal...</text></switch></g></g><g><path d="M 340 598 L 650 598" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g><g><rect x="340" y="602" width="310" height="72" fill="none" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 300px; height: 1px; padding-top: 609px; margin-left: 346px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 68px; overflow: hidden;"><div style="display: inline-block; font-size: 8px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">+ prepareMainLooper():void //为主线程创建Looper对象<div style="font-size: 8px;">+ getMainLooper(): Looper //获取主线程的Looper对象<br style="font-size: 8px;" /><div style="font-size: 8px;"><span style="background-color: initial; font-size: 8px;">+ </span>prepare(quitAllow): void // 每个线程只能调用一次<div style="font-size: 8px;">+ myLooper(): Looper //获取当前线程的Looper对象<br style="font-size: 8px;" /></div></div></div><div style="font-size: 8px;">+ loop(): void //死循环消息列表<br style="font-size: 8px;" /></div><div style="font-size: 8px;">+ loopOnce(): void</div></div></div></div></foreignObject><text x="346" y="617" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="8px">+ prepareMainLooper():void //为主线程创建Looper对象...</text></switch></g></g><g><rect x="0" y="549" width="330" height="70" fill="#000000" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 328px; height: 1px; padding-top: 556px; margin-left: 2px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 6px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style="color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><pre><span style="color: rgb(213, 95, 222); font-style: italic;">static final </span><span style="color: rgb(229, 192, 123);">ThreadLocal</span>&lt;<span style="color: rgb(229, 192, 123);">Looper</span>&gt; <span style="color: rgb(209, 154, 102);">sThreadLocal </span>= <span style="color: rgb(213, 95, 222); font-style: italic;">new </span><span style="color: rgb(229, 192, 123);">ThreadLocal</span>&lt;<span style="color: rgb(229, 192, 123);">Looper</span>&gt;();</pre></pre><pre style="color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">private static void </span><span style="color: rgb(97, 175, 239); font-size: 6px;">prepare</span>(<span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">boolean </span><span style="color: rgb(209, 154, 102); font-size: 6px;">quitAllowed</span>) {<br style="font-size: 6px;" />    <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">if </span>(<span style="color: rgb(209, 154, 102); font-size: 6px;">sThreadLocal</span>.<span style="color: rgb(97, 175, 239); font-size: 6px;">get</span>() != <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">null</span>) {<br style="font-size: 6px;" />        <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">throw new </span><span style="color: rgb(229, 192, 123); font-size: 6px;">RuntimeException</span>(<span style="color: rgb(137, 202, 120); font-size: 6px;">"Only one Looper may be created per thread"</span>);<br style="font-size: 6px;" />    }<br style="font-size: 6px;" />    <span style="color: rgb(209, 154, 102); font-size: 6px;">sThreadLocal</span>.<span style="color: rgb(97, 175, 239); font-size: 6px;">set</span>(<span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">new </span><span style="color: rgb(229, 192, 123); font-size: 6px;">Looper</span>(<span style="color: rgb(209, 154, 102); font-size: 6px;">quitAllowed</span>));<br style="font-size: 6px;" />}</pre></div></div></div></foreignObject><text x="2" y="562" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="6px">static final ThreadLocal&lt;Looper&gt; sThreadLocal = new ThreadLocal&lt;Looper&gt;();...</text></switch></g></g><g><rect x="0" y="619" width="200" height="50" fill="#000000" stroke="none" pointer-events="all"/></g><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 198px; height: 1px; padding-top: 626px; margin-left: 2px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 6px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style="color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">public static </span><span style="color: rgb(229, 192, 123); font-style: italic; font-size: 6px;">@Nullable </span><span style="color: rgb(229, 192, 123); font-size: 6px;">Looper </span><span style="color: rgb(97, 175, 239); font-size: 6px;">myLooper</span>() {<br style="font-size: 6px;" />    <span style="color: rgb(213, 95, 222); font-style: italic; font-size: 6px;">return </span><span style="color: rgb(209, 154, 102); font-size: 6px;">sThreadLocal</span>.<span style="color: rgb(97, 175, 239); font-size: 6px;">get</span>();<br style="font-size: 6px;" />}</pre></div></div></div></foreignObject><text x="2" y="632" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="6px">public static @Nullable Looper myLooper() {...</text></switch></g></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.drawio.com/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>