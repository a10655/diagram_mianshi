<mxfile host="app.diagrams.net" modified="2024-04-09T03:52:30.156Z" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36" etag="dhYWUbIjQG4CmlOOEsAO" version="24.2.0" type="device" pages="2">
  <diagram id="KgLerE87KBL7YLeJpYM6" name="Handle">
    <mxGraphModel dx="254" dy="1378" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="SVF_KBN14g_UiQ-_b-FJ-2" target="SVF_KBN14g_UiQ-_b-FJ-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-2" value="&lt;pre style=&quot;font-size: 8px; text-align: left;&quot;&gt;发送消息&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontColor=default;" parent="1" vertex="1">
          <mxGeometry x="2760" y="81" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-3" value="&lt;pre style=&quot;font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; font-size: 6px; text-align: left; color: rgb(187, 187, 187);&quot;&gt;&lt;pre style=&quot;font-size: 6px;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;public final boolean &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;sendMessage&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123); font-style: italic; font-size: 6px;&quot;&gt;@NonNull &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Message &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;sendMessageDelayed&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;, &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;0&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;/pre&gt;&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#000000;fontSize=6;" parent="1" vertex="1">
          <mxGeometry x="2960" y="76" width="210" height="44" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-30" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="SVF_KBN14g_UiQ-_b-FJ-4" target="SVF_KBN14g_UiQ-_b-FJ-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-4" value="&lt;pre style=&quot;font-size: 8px; text-align: left;&quot;&gt;发送延时消息&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontColor=default;" parent="1" vertex="1">
          <mxGeometry x="2760" y="160" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-13" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;public final boolean &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;sendMessageDelayed&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123); font-style: italic; font-size: 6px;&quot;&gt;@NonNull &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Message &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;, &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;delayMillis&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;delayMillis &lt;/span&gt;&amp;lt; &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;0&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;delayMillis &lt;/span&gt;= &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;0&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    }&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;sendMessageAtTime&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;, &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;SystemClock&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;uptimeMillis&lt;/span&gt;() + &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;delayMillis&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;pre style=&quot;font-size: 6px;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;public boolean &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;sendMessageAtTime&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123); font-style: italic; font-size: 6px;&quot;&gt;@NonNull &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Message &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;, &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;uptimeMillis&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;MessageQueue &lt;/span&gt;queue = &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;mQueue&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(queue == &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Log&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;w&lt;/span&gt;(&lt;span style=&quot;color: rgb(137, 202, 120); font-size: 6px;&quot;&gt;&quot;Looper&quot;&lt;/span&gt;, &quot;sendMessageAtTime() called with no mQueue&quot;, e);&lt;br&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return false&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    }&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;enqueueMessage&lt;/span&gt;(queue, &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;, &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;uptimeMillis&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;/pre&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="2960" y="130" width="310" height="120" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-18" value="Handler" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fontSize=8;" parent="1" vertex="1">
          <mxGeometry x="2131" y="36" width="309" height="110" as="geometry">
            <mxRectangle x="2131" y="36" width="80" height="30" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-19" value="+ mLooper:Looper&lt;div style=&quot;font-size: 8px;&quot;&gt;+ mQueue:MessageQueue&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="SVF_KBN14g_UiQ-_b-FJ-18" vertex="1">
          <mxGeometry y="26" width="309" height="34" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-20" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;fontSize=8;" parent="SVF_KBN14g_UiQ-_b-FJ-18" vertex="1">
          <mxGeometry y="60" width="309" height="8" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-21" value="+&amp;nbsp;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;sendMessageAtTime&lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial; font-style: italic;&quot;&gt;@NonNull &lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;Message &lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;msg&lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial; font-style: italic;&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;uptimeMillis&lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 8px;&quot;&gt;:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 8px; background-color: initial;&quot;&gt;boolean&amp;nbsp;&lt;/span&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;+&amp;nbsp;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;enqueueMessage&lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial; font-style: italic;&quot;&gt;@NonNull &lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;MessageQueue &lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;queue&lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial; font-style: italic;&quot;&gt;@NonNull &lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;Message &lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;msg&lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial; font-style: italic;&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;uptimeMillis&lt;/span&gt;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 8px;&quot;&gt;:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-style: italic; font-size: 8px;&quot;&gt;boolean&amp;nbsp;&lt;/span&gt;&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontColor=#000000;fontSize=8;" parent="SVF_KBN14g_UiQ-_b-FJ-18" vertex="1">
          <mxGeometry y="68" width="309" height="42" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-34" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="SVF_KBN14g_UiQ-_b-FJ-29" target="SVF_KBN14g_UiQ-_b-FJ-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-35" value="调用MessageQueue类的入队方法" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="SVF_KBN14g_UiQ-_b-FJ-34" vertex="1" connectable="0">
          <mxGeometry x="0.5383" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-29" value="&lt;pre style=&quot;font-size: 8px; text-align: left;&quot;&gt;消息入队&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontColor=default;" parent="1" vertex="1">
          <mxGeometry x="2760" y="220" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-32" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;private boolean &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;enqueueMessage&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123); font-style: italic; font-size: 6px;&quot;&gt;@NonNull &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;MessageQueue &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;queue&lt;/span&gt;, &lt;span style=&quot;color: rgb(229, 192, 123); font-style: italic; font-size: 6px;&quot;&gt;@NonNull &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Message &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;,&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;uptimeMillis&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;.target = &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;this&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;.workSourceUid = &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;ThreadLocalWorkSource&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;getUid&lt;/span&gt;();&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;mAsynchronous&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;setAsynchronous&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;true&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;    }&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;queue&lt;/span&gt;.enqueueMessage(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;, &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;uptimeMillis&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="2960" y="249" width="310" height="91" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-41" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="SVF_KBN14g_UiQ-_b-FJ-33" target="SVF_KBN14g_UiQ-_b-FJ-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-33" value="&lt;pre style=&quot;font-size: 8px; text-align: left;&quot;&gt;消息入队&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontColor=default;" parent="1" vertex="1">
          <mxGeometry x="2760" y="298.75" width="120" height="20" as="geometry" />
        </mxCell>
        <UserObject label="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;enqueueMessage&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Message &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;, &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;when&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;.target == &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;IllegalArgumentException&lt;/span&gt;(&lt;span style=&quot;color: rgb(137, 202, 120); font-size: 6px;&quot;&gt;&quot;Message must have a target.&quot;&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;    }&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;synchronized &lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;this&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;.isInUse()) {&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;IllegalStateException&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg &lt;/span&gt;+ &lt;span style=&quot;color: rgb(137, 202, 120); font-size: 6px;&quot;&gt;&quot; This message is already in use.&quot;&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;        }&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;mQuitting&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;IllegalStateException &lt;/span&gt;e = &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;IllegalStateException&lt;/span&gt;(&lt;br style=&quot;font-size: 6px;&quot;&gt;                    &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;.target + &lt;span style=&quot;color: rgb(137, 202, 120); font-size: 6px;&quot;&gt;&quot; sending message to a Handler on a dead thread&quot;&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Log&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;w&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;TAG&lt;/span&gt;, e.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;getMessage&lt;/span&gt;(), e);&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;recycle&lt;/span&gt;();&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return false&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;        }&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;.markInUse();&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;.when = &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;when&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Message &lt;/span&gt;p = &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;mMessages&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;boolean &lt;/span&gt;needWake;&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(p == &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null &lt;/span&gt;|| &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;when &lt;/span&gt;== &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;0 &lt;/span&gt;|| &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;when &lt;/span&gt;&amp;lt; p.when) {&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;// New head, wake up the event queue if blocked.&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;.next = p;&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;mMessages &lt;/span&gt;= &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;            needWake = &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;mBlocked&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;        } &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;else &lt;/span&gt;{&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;// Inserted within the middle of the queue.  Usually we don&#39;t have to wake&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;            // up the event queue unless there is a barrier at the head of the queue&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;            // and the message is the earliest asynchronous message in the queue.&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;            &lt;/span&gt;needWake = &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;mBlocked &lt;/span&gt;&amp;amp;&amp;amp; p.target == &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null &lt;/span&gt;&amp;amp;&amp;amp; &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;isAsynchronous&lt;/span&gt;();&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Message &lt;/span&gt;prev;&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;for &lt;/span&gt;(;;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;                prev = p;&lt;br style=&quot;font-size: 6px;&quot;&gt;                p = p.next;&lt;br style=&quot;font-size: 6px;&quot;&gt;                &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(p == &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null &lt;/span&gt;|| &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;when &lt;/span&gt;&amp;lt; p.when) {&lt;br style=&quot;font-size: 6px;&quot;&gt;                    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;break&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;                }&lt;br style=&quot;font-size: 6px;&quot;&gt;                &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(needWake &amp;amp;&amp;amp; p.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;isAsynchronous&lt;/span&gt;()) {&lt;br style=&quot;font-size: 6px;&quot;&gt;                    needWake = &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;false&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;                }&lt;br style=&quot;font-size: 6px;&quot;&gt;            }&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;.next = p; &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;// invariant: p == prev.next&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;            &lt;/span&gt;prev.next = &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;msg&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;        }&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;// We can assume mPtr != 0 because mQuitting is false.&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(needWake) {&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;nativeWake&lt;/span&gt;(&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;mPtr&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;        }&lt;br style=&quot;font-size: 6px;&quot;&gt;    }&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return true&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;/pre&gt;" link="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 20px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;enqueueMessage&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Message &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;, &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;when&lt;/span&gt;) {&lt;br&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.target == &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;null&lt;/span&gt;) {&lt;br&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;IllegalArgumentException&lt;/span&gt;(&lt;span style=&quot;color: rgb(137, 202, 120);&quot;&gt;&quot;Message must have a target.&quot;&lt;/span&gt;);&lt;br&gt;    }&lt;br&gt;&lt;br&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;synchronized &lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;this&lt;/span&gt;) {&lt;br&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.isInUse()) {&lt;br&gt;            &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;IllegalStateException&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg &lt;/span&gt;+ &lt;span style=&quot;color: rgb(137, 202, 120);&quot;&gt;&quot; This message is already in use.&quot;&lt;/span&gt;);&lt;br&gt;        }&lt;br&gt;&lt;br&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;color: rgb(239, 89, 111);&quot;&gt;mQuitting&lt;/span&gt;) {&lt;br&gt;            &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;IllegalStateException &lt;/span&gt;e = &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;IllegalStateException&lt;/span&gt;(&lt;br&gt;                    &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.target + &lt;span style=&quot;color: rgb(137, 202, 120);&quot;&gt;&quot; sending message to a Handler on a dead thread&quot;&lt;/span&gt;);&lt;br&gt;            &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Log&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;w&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;TAG&lt;/span&gt;, e.&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;getMessage&lt;/span&gt;(), e);&lt;br&gt;            &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;recycle&lt;/span&gt;();&lt;br&gt;            &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;return false&lt;/span&gt;;&lt;br&gt;        }&lt;br&gt;&lt;br&gt;        &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.markInUse();&lt;br&gt;        &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.when = &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;when&lt;/span&gt;;&lt;br&gt;        &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Message &lt;/span&gt;p = &lt;span style=&quot;color: rgb(239, 89, 111);&quot;&gt;mMessages&lt;/span&gt;;&lt;br&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;boolean &lt;/span&gt;needWake;&lt;br&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(p == &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;null &lt;/span&gt;|| &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;when &lt;/span&gt;== &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;0 &lt;/span&gt;|| &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;when &lt;/span&gt;&amp;lt; p.when) {&lt;br&gt;            &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;// New head, wake up the event queue if blocked.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.next = p;&lt;br&gt;            &lt;span style=&quot;color: rgb(239, 89, 111);&quot;&gt;mMessages &lt;/span&gt;= &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;;&lt;br&gt;            needWake = &lt;span style=&quot;color: rgb(239, 89, 111);&quot;&gt;mBlocked&lt;/span&gt;;&lt;br&gt;        } &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;else &lt;/span&gt;{&lt;br&gt;            &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;// Inserted within the middle of the queue.  Usually we don&#39;t have to wake&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;            // up the event queue unless there is a barrier at the head of the queue&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;            // and the message is the earliest asynchronous message in the queue.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;            &lt;/span&gt;needWake = &lt;span style=&quot;color: rgb(239, 89, 111);&quot;&gt;mBlocked &lt;/span&gt;&amp;amp;&amp;amp; p.target == &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;null &lt;/span&gt;&amp;amp;&amp;amp; &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;isAsynchronous&lt;/span&gt;();&lt;br&gt;            &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Message &lt;/span&gt;prev;&lt;br&gt;            &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;for &lt;/span&gt;(;;) {&lt;br&gt;                prev = p;&lt;br&gt;                p = p.next;&lt;br&gt;                &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(p == &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;null &lt;/span&gt;|| &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;when &lt;/span&gt;&amp;lt; p.when) {&lt;br&gt;                    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;break&lt;/span&gt;;&lt;br&gt;                }&lt;br&gt;                &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(needWake &amp;amp;&amp;amp; p.&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;isAsynchronous&lt;/span&gt;()) {&lt;br&gt;                    needWake = &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;false&lt;/span&gt;;&lt;br&gt;                }&lt;br&gt;            }&lt;br&gt;            &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;.next = p; &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;// invariant: p == prev.next&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;            &lt;/span&gt;prev.next = &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;msg&lt;/span&gt;;&lt;br&gt;        }&lt;br&gt;&lt;br&gt;        &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;// We can assume mPtr != 0 because mQuitting is false.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(needWake) {&lt;br&gt;            &lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;nativeWake&lt;/span&gt;(&lt;span style=&quot;color: rgb(239, 89, 111);&quot;&gt;mPtr&lt;/span&gt;);&lt;br&gt;        }&lt;br&gt;    }&lt;br&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;return true&lt;/span&gt;;&lt;br&gt;}&lt;/pre&gt;" id="SVF_KBN14g_UiQ-_b-FJ-39">
          <mxCell style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;" parent="1" vertex="1">
            <mxGeometry x="2960" y="340" width="320" height="410" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-43" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="SVF_KBN14g_UiQ-_b-FJ-40" target="SVF_KBN14g_UiQ-_b-FJ-42" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-44" value="否" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="SVF_KBN14g_UiQ-_b-FJ-43" vertex="1" connectable="0">
          <mxGeometry x="-0.0769" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-46" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="SVF_KBN14g_UiQ-_b-FJ-40" target="SVF_KBN14g_UiQ-_b-FJ-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-50" value="是" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="SVF_KBN14g_UiQ-_b-FJ-46" vertex="1" connectable="0">
          <mxGeometry x="-0.1917" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-40" value="判断msg是否有对应的handler" style="rhombus;whiteSpace=wrap;html=1;rounded=0;fontSize=6;" parent="1" vertex="1">
          <mxGeometry x="2780" y="340" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-42" value="扔异常" style="whiteSpace=wrap;html=1;fontSize=6;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="2670" y="370" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-48" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="SVF_KBN14g_UiQ-_b-FJ-45" target="SVF_KBN14g_UiQ-_b-FJ-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-49" value="是" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="SVF_KBN14g_UiQ-_b-FJ-48" vertex="1" connectable="0">
          <mxGeometry x="-0.2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-52" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="SVF_KBN14g_UiQ-_b-FJ-45" target="SVF_KBN14g_UiQ-_b-FJ-51" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-56" value="否" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="SVF_KBN14g_UiQ-_b-FJ-52" vertex="1" connectable="0">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-45" value="判断msg是否已经被使用了" style="rhombus;whiteSpace=wrap;html=1;rounded=0;fontSize=6;" parent="1" vertex="1">
          <mxGeometry x="2780" y="455" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-47" value="扔异常" style="whiteSpace=wrap;html=1;fontSize=6;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="2680" y="485" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-54" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="SVF_KBN14g_UiQ-_b-FJ-51" target="SVF_KBN14g_UiQ-_b-FJ-53" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-55" value="是" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="SVF_KBN14g_UiQ-_b-FJ-54" vertex="1" connectable="0">
          <mxGeometry x="-0.2222" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-69" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="SVF_KBN14g_UiQ-_b-FJ-51" target="SVF_KBN14g_UiQ-_b-FJ-68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-70" value="否" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="SVF_KBN14g_UiQ-_b-FJ-69" vertex="1" connectable="0">
          <mxGeometry x="-0.4271" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-51" value="判断当前handle所在的线程是否正在退出" style="rhombus;whiteSpace=wrap;html=1;rounded=0;fontSize=6;" parent="1" vertex="1">
          <mxGeometry x="2780" y="566.75" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-53" value="销毁消息，返回false" style="whiteSpace=wrap;html=1;fontSize=6;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="2600" y="591.75" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-57" value="上锁，同步代码块" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2760" y="455" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-58" value="MessageQueue" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fontSize=8;" parent="1" vertex="1">
          <mxGeometry x="2130" y="180" width="310" height="84" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-59" value="+ mMessages: Message&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="SVF_KBN14g_UiQ-_b-FJ-58" vertex="1">
          <mxGeometry y="26" width="310" height="24" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-60" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;fontSize=8;" parent="SVF_KBN14g_UiQ-_b-FJ-58" vertex="1">
          <mxGeometry y="50" width="310" height="8" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-61" value="+ enqueueMessage(type): boolean" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="SVF_KBN14g_UiQ-_b-FJ-58" vertex="1">
          <mxGeometry y="58" width="310" height="26" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-62" value="Message" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fontSize=8;" parent="1" vertex="1">
          <mxGeometry x="2131" y="337" width="309" height="144" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-63" value="+ when: long&lt;div style=&quot;font-size: 8px;&quot;&gt;+ target:Handle&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;+ data:Bundle&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;+ next: Message&amp;nbsp; &amp;nbsp; &amp;nbsp;//由此构成消息的单项链表&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;+ sPool: Message&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;+ sPoolSize: int&amp;nbsp;&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;+ MAX_POOL_SIZE: int // 50&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="SVF_KBN14g_UiQ-_b-FJ-62" vertex="1">
          <mxGeometry y="26" width="309" height="84" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-64" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;fontSize=8;" parent="SVF_KBN14g_UiQ-_b-FJ-62" vertex="1">
          <mxGeometry y="110" width="309" height="8" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-65" value="+ obtain(): Message" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="SVF_KBN14g_UiQ-_b-FJ-62" vertex="1">
          <mxGeometry y="118" width="309" height="26" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-72" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="SVF_KBN14g_UiQ-_b-FJ-68" target="SVF_KBN14g_UiQ-_b-FJ-71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-73" value="是" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="SVF_KBN14g_UiQ-_b-FJ-72" vertex="1" connectable="0">
          <mxGeometry x="-0.0111" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-75" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="SVF_KBN14g_UiQ-_b-FJ-68" target="SVF_KBN14g_UiQ-_b-FJ-74" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-76" value="否" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="SVF_KBN14g_UiQ-_b-FJ-75" vertex="1" connectable="0">
          <mxGeometry x="-0.1278" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-68" value="判断msg链表是否为空&lt;div&gt;或者插入消息的when==0&lt;br&gt;或者when&amp;lt;p.when&lt;/div&gt;" style="rhombus;whiteSpace=wrap;html=1;rounded=0;fontSize=6;" parent="1" vertex="1">
          <mxGeometry x="2780" y="726.75" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-71" value="将消息插在队列头部" style="whiteSpace=wrap;html=1;fontSize=6;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="2600" y="756.75" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-74" value="将消息插入消息链表对应的位置" style="whiteSpace=wrap;html=1;fontSize=6;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="2760" y="870" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-77" value="Looper" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fontSize=8;" parent="1" vertex="1">
          <mxGeometry x="2130" y="550" width="310" height="160" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-78" value="+ sThreadLocal: ThreadLocal&lt;div style=&quot;font-size: 8px;&quot;&gt;+ sMainLooper: Looper&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;+ mQueue: MessageQueue&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;+ mThread: Thread&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="SVF_KBN14g_UiQ-_b-FJ-77" vertex="1">
          <mxGeometry y="26" width="310" height="54" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-79" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;fontSize=8;" parent="SVF_KBN14g_UiQ-_b-FJ-77" vertex="1">
          <mxGeometry y="80" width="310" height="8" as="geometry" />
        </mxCell>
        <mxCell id="SVF_KBN14g_UiQ-_b-FJ-80" value="+ prepareMainLooper():void //为主线程创建Looper对象&lt;div style=&quot;font-size: 8px;&quot;&gt;+ getMainLooper(): Looper //获取主线程的Looper对象&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 8px;&quot;&gt;+&amp;nbsp;&lt;/span&gt;prepare(quitAllow): void // 每个线程只能调用一次&lt;div style=&quot;font-size: 8px;&quot;&gt;+ myLooper(): Looper //获取当前线程的Looper对象&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;+ loop(): void //死循环消息列表&lt;br style=&quot;font-size: 8px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;+ loopOnce(): void&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="SVF_KBN14g_UiQ-_b-FJ-77" vertex="1">
          <mxGeometry y="88" width="310" height="72" as="geometry" />
        </mxCell>
        <mxCell id="htp0pqVOB_GgmM7RNFBv-2" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;pre&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;static final &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;ThreadLocal&lt;/span&gt;&amp;lt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Looper&lt;/span&gt;&amp;gt; &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;sThreadLocal &lt;/span&gt;= &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;ThreadLocal&lt;/span&gt;&amp;lt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Looper&lt;/span&gt;&amp;gt;();&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;private static void &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;prepare&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;quitAllowed&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;sThreadLocal&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;get&lt;/span&gt;() != &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;RuntimeException&lt;/span&gt;(&lt;span style=&quot;color: rgb(137, 202, 120); font-size: 6px;&quot;&gt;&quot;Only one Looper may be created per thread&quot;&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;    }&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;sThreadLocal&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;set&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Looper&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;quitAllowed&lt;/span&gt;));&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="1790" y="585" width="330" height="70" as="geometry" />
        </mxCell>
        <mxCell id="htp0pqVOB_GgmM7RNFBv-4" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;public static &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-style: italic; font-size: 6px;&quot;&gt;@Nullable &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Looper &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;myLooper&lt;/span&gt;() {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;sThreadLocal&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;get&lt;/span&gt;();&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fillColor=#000000;fontSize=6;" parent="1" vertex="1">
          <mxGeometry x="1790" y="655" width="200" height="50" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="B5dIO6AN51XFmtcyMUDD" name="ThreadLocal">
    <mxGraphModel dx="-594" dy="766" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="4JSQju-QF8H9R8TIQm2g-1" value="ThreadLocal" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1720" y="40" width="200" height="130" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-2" value="&lt;div&gt;-&amp;nbsp;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;HASH_INCREMENT: int = 0x61c88647&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="4JSQju-QF8H9R8TIQm2g-1" vertex="1">
          <mxGeometry y="26" width="200" height="26" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="4JSQju-QF8H9R8TIQm2g-1" vertex="1">
          <mxGeometry y="52" width="200" height="8" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-4" value="+ set(T): void&lt;div&gt;+ get(): T&lt;br&gt;&lt;/div&gt;&lt;div&gt;getMap(Thread): ThreadLocalMap&lt;/div&gt;&lt;div&gt;createMap(Thread, T): void&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="4JSQju-QF8H9R8TIQm2g-1" vertex="1">
          <mxGeometry y="60" width="200" height="70" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-5" value="ThreadLocalMap" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1720" y="190" width="190" height="130" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-6" value="- INITIAL_CAPACITY: int = 16&lt;div&gt;- table: Entry[]&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="4JSQju-QF8H9R8TIQm2g-5" vertex="1">
          <mxGeometry y="26" width="190" height="44" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-7" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="4JSQju-QF8H9R8TIQm2g-5" vertex="1">
          <mxGeometry y="70" width="190" height="8" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-8" value="- set(T): void&lt;div&gt;- getEntry(ThreadLocal): Entry&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="4JSQju-QF8H9R8TIQm2g-5" vertex="1">
          <mxGeometry y="78" width="190" height="52" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-9" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;public void &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;set&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;T &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;value&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Thread &lt;/span&gt;t = &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Thread&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;currentThread&lt;/span&gt;();&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;ThreadLocalMap &lt;/span&gt;map = &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;getMap&lt;/span&gt;(t);&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(map != &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;)&lt;br style=&quot;font-size: 6px;&quot;&gt;        map.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;set&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;this&lt;/span&gt;, &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;value&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;else&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;createMap&lt;/span&gt;(t, &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;value&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;br&gt;&lt;pre&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;public &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;T &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;get&lt;/span&gt;() {&lt;br&gt;    &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Thread &lt;/span&gt;t = &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Thread&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;currentThread&lt;/span&gt;();&lt;br&gt;    &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;ThreadLocalMap &lt;/span&gt;map = &lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;getMap&lt;/span&gt;(t);&lt;br&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(map != &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;null&lt;/span&gt;) {&lt;br&gt;        &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;ThreadLocalMap&lt;/span&gt;.&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Entry &lt;/span&gt;e = map.&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;getEntry&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;this&lt;/span&gt;);&lt;br&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(e != &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;null&lt;/span&gt;) {&lt;br&gt;            &lt;span style=&quot;color: rgb(229, 192, 123); font-style: italic;&quot;&gt;@SuppressWarnings&lt;/span&gt;(&lt;span style=&quot;color: rgb(137, 202, 120);&quot;&gt;&quot;unchecked&quot;&lt;/span&gt;)&lt;br&gt;            &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;T &lt;/span&gt;result = (&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;T&lt;/span&gt;)e.&lt;span style=&quot;color: rgb(239, 89, 111);&quot;&gt;value&lt;/span&gt;;&lt;br&gt;            &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;return &lt;/span&gt;result;&lt;br&gt;        }&lt;br&gt;    }&lt;br&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;setInitialValue&lt;/span&gt;();&lt;br&gt;}&lt;/pre&gt;&lt;pre&gt;&lt;br&gt;&lt;pre&gt;&lt;br&gt;&lt;/pre&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="1900" y="451" width="212" height="180" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-11" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;private void &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;set&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;ThreadLocal&lt;/span&gt;&amp;lt;?&amp;gt; &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;, &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Object &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;value&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;// We don&#39;t use a fast path as with get() because it is at&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;    // least as common to use set() to create new entries as&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;    // it is to replace existing ones, in which case, a fast&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;    // path would fail more often than not.&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry&lt;/span&gt;[] tab = &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;table&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;len = tab.&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;length&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;i = &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;.threadLocalHashCode &amp;amp; (len-&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;for &lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry &lt;/span&gt;e = tab[i];&lt;br style=&quot;font-size: 6px;&quot;&gt;         e != &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;         e = tab[i = &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;nextIndex&lt;/span&gt;(i, len)]) {&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;// Android-changed: Use refersTo() (twice).&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;        // ThreadLocal&amp;lt;?&amp;gt; k = e.get();&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;        // if (k == key) { ... } if (k == null) { ... }&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(e.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;refersTo&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;)) {&lt;br style=&quot;font-size: 6px;&quot;&gt;            e.&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;value &lt;/span&gt;= &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;value&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;        }&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(e.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;refersTo&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;)) {&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;replaceStaleEntry&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;, &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;value&lt;/span&gt;, i);&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;        }&lt;br style=&quot;font-size: 6px;&quot;&gt;    }&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;    tab[i] = &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;, &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;value&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;sz = ++&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;size&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(!&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;cleanSomeSlots&lt;/span&gt;(i, sz) &amp;amp;&amp;amp; sz &amp;gt;= &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;threshold&lt;/span&gt;)&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;rehash&lt;/span&gt;();&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="1862" y="631" width="250" height="270" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-13" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;private &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;getEntry&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;ThreadLocal&lt;/span&gt;&amp;lt;?&amp;gt; &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;i = &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;.threadLocalHashCode &amp;amp; (&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;table&lt;/span&gt;.&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;length &lt;/span&gt;- &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry &lt;/span&gt;e = &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;table&lt;/span&gt;[i];&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;// Android-changed: Use refersTo().&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(e != &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null &lt;/span&gt;&amp;amp;&amp;amp; e.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;refersTo&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;))&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return &lt;/span&gt;e;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;else&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;        return &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;getEntryAfterMiss&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;, i, e);&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="1862" y="900" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Usvd829vFf0LGTeXWWfx-1" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;ThreadLocalMap &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;getMap&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;t&lt;/span&gt;) {&lt;br&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;t&lt;/span&gt;.threadLocals;&lt;br&gt;}&lt;/pre&gt;&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;pre&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;void &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;createMap&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;t&lt;/span&gt;, &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;T &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;firstValue&lt;/span&gt;) {&lt;br&gt;    &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;t&lt;/span&gt;.threadLocals = &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;new &lt;br/&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;ThreadLocalMap&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;this&lt;/span&gt;, &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;firstValue&lt;/span&gt;);&lt;br&gt;}&lt;/pre&gt;&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="1722" y="467" width="180" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Usvd829vFf0LGTeXWWfx-3" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;ThreadLocalMap&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;ThreadLocal&lt;/span&gt;&amp;lt;?&amp;gt; &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;firstKey&lt;/span&gt;, &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Object &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;firstValue&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;table &lt;/span&gt;= &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry&lt;/span&gt;[&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;INITIAL_CAPACITY&lt;/span&gt;];&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;i = &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;firstKey&lt;/span&gt;.threadLocalHashCode &amp;amp; (&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;INITIAL_CAPACITY &lt;/span&gt;- &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;table&lt;/span&gt;[i] = &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;firstKey&lt;/span&gt;, &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;firstValue&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;size &lt;/span&gt;= &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;setThreshold&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;INITIAL_CAPACITY&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;br/&gt;&lt;pre&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;private void &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;setThreshold&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;len&lt;/span&gt;) {&lt;br&gt;    &lt;span style=&quot;color: rgb(239, 89, 111);&quot;&gt;threshold &lt;/span&gt;= &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;len &lt;/span&gt;* &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;2 &lt;/span&gt;/ &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;3&lt;/span&gt;;&lt;br&gt;}&lt;/pre&gt;&lt;br/&gt;&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="2112" y="631" width="290" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Usvd829vFf0LGTeXWWfx-7" value="&lt;div style=&quot;font-size: 8px;&quot;&gt;ThreadLocal对象进行set(T)的时候，会获取当前线程中的ThreadLocalMap对象；然后将数据存放在ThreadLocalMap中。&lt;/div&gt;每个线程都有一个ThreadLocalMap，里面存放的数据是Entry数组，每个Entry是以ThreadLocal为key，T为value进行存储；" style="whiteSpace=wrap;html=1;align=left;fontSize=8;" parent="1" vertex="1">
          <mxGeometry x="1962" y="232" width="270" height="60" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-2" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;private static int &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;nextIndex&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;i&lt;/span&gt;, &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;len&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return &lt;/span&gt;((&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;i &lt;/span&gt;+ &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1 &lt;/span&gt;&amp;lt; &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;len&lt;/span&gt;) ? &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;i &lt;/span&gt;+ &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1 &lt;/span&gt;: &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;0&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;private static int &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;prevIndex&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;i&lt;/span&gt;, &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;len&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return &lt;/span&gt;((&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;i &lt;/span&gt;- &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1 &lt;/span&gt;&amp;gt;= &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;0&lt;/span&gt;) ? &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;i &lt;/span&gt;- &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1 &lt;/span&gt;: &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;len &lt;/span&gt;- &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="1693" y="726" width="170" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-4" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;private void &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;rehash&lt;/span&gt;() {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;expungeStaleEntries&lt;/span&gt;();&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;// Use lower threshold for doubling to avoid hysteresis&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;size &lt;/span&gt;&amp;gt;= &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;threshold &lt;/span&gt;- &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;threshold &lt;/span&gt;/ &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;4&lt;/span&gt;)&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;resize&lt;/span&gt;();&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;/**&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt; * Double the capacity of the table.&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt; */&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;private void &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;resize&lt;/span&gt;() {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry&lt;/span&gt;[] oldTab = &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;table&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;oldLen = oldTab.&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;length&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;newLen = oldLen * &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;2&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry&lt;/span&gt;[] newTab = &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry&lt;/span&gt;[newLen];&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;count = &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;0&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;for &lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;j = &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;0&lt;/span&gt;; j &amp;lt; oldLen; ++j) {&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry &lt;/span&gt;e = oldTab[j];&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(e != &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;ThreadLocal&lt;/span&gt;&amp;lt;?&amp;gt; k = e.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;get&lt;/span&gt;();&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(k == &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;                e.&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;value &lt;/span&gt;= &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;; &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;// Help the GC&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;            &lt;/span&gt;} &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;else &lt;/span&gt;{&lt;br style=&quot;font-size: 6px;&quot;&gt;                &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;h = k.threadLocalHashCode &amp;amp; (newLen - &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;                &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;while &lt;/span&gt;(newTab[h] != &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;)&lt;br style=&quot;font-size: 6px;&quot;&gt;                    h = &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;nextIndex&lt;/span&gt;(h, newLen);&lt;br style=&quot;font-size: 6px;&quot;&gt;                newTab[h] = e;&lt;br style=&quot;font-size: 6px;&quot;&gt;                count++;&lt;br style=&quot;font-size: 6px;&quot;&gt;            }&lt;br style=&quot;font-size: 6px;&quot;&gt;        }&lt;br style=&quot;font-size: 6px;&quot;&gt;    }&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;setThreshold&lt;/span&gt;(newLen);&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;size &lt;/span&gt;= count;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;table &lt;/span&gt;= newTab;&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="2111" y="859" width="260" height="310" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-7" value="Thread" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fontSize=8;" parent="1" vertex="1">
          <mxGeometry x="2020" y="40" width="180" height="52" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-8" value="+ threadLocals: ThreadLocal.ThreadLocalMap" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-7" vertex="1">
          <mxGeometry y="26" width="180" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-11" value="" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=0;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;whiteSpace=wrap;html=1;fontSize=8;" parent="1" vertex="1">
          <mxGeometry x="2240" y="70" width="152" height="208" as="geometry">
            <mxRectangle x="1170" y="410" width="50" height="40" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-16" value="entry: Entry --&amp;gt; (ThreadLocal, Tvalue)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-11" vertex="1">
          <mxGeometry width="152" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-18" value="entry1: Entry&amp;nbsp;--&amp;gt; (ThreadLocal, Tvalue)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-11" vertex="1">
          <mxGeometry y="26" width="152" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-19" value="entry2: Entry&amp;nbsp;--&amp;gt; (ThreadLocal, Tvalue)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-11" vertex="1">
          <mxGeometry y="52" width="152" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-21" value="entry3: Entry&amp;nbsp;--&amp;gt; (ThreadLocal, Tvalue)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-11" vertex="1">
          <mxGeometry y="78" width="152" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-23" value="entry4: Entry&amp;nbsp;--&amp;gt; (ThreadLocal, Tvalue)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-11" vertex="1">
          <mxGeometry y="104" width="152" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-24" value="entry5: Entry&amp;nbsp;--&amp;gt; (ThreadLocal, Tvalue)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-11" vertex="1">
          <mxGeometry y="130" width="152" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-25" value="entry6: Entry&amp;nbsp;--&amp;gt; (ThreadLocal, Tvalue)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-11" vertex="1">
          <mxGeometry y="156" width="152" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-26" value="......" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-11" vertex="1">
          <mxGeometry y="182" width="152" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-28" value="" style="endArrow=open;endFill=1;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=-0.019;entryY=0.33;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=8;" parent="1" source="YRkNxRZ61KOj2W9NJHFv-8" target="YRkNxRZ61KOj2W9NJHFv-16" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2232" y="270" as="sourcePoint" />
            <mxPoint x="2392" y="270" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fzmKr-huMYEFjz7aQjL3-1" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;pre&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;static final &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;ThreadLocal&lt;/span&gt;&amp;lt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Looper&lt;/span&gt;&amp;gt; &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;sThreadLocal &lt;/span&gt;= &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;ThreadLocal&lt;/span&gt;&amp;lt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Looper&lt;/span&gt;&amp;gt;();&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;private static void &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;prepare&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;quitAllowed&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;sThreadLocal&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;get&lt;/span&gt;() != &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;RuntimeException&lt;/span&gt;(&lt;span style=&quot;color: rgb(137, 202, 120); font-size: 6px;&quot;&gt;&quot;Only one Looper may be created per thread&quot;&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;    }&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;sThreadLocal&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;set&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Looper&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;quitAllowed&lt;/span&gt;));&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;br/&gt;&lt;pre&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;public static &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-style: italic;&quot;&gt;@Nullable &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Looper &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;myLooper&lt;/span&gt;() {&lt;br&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;sThreadLocal&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;get&lt;/span&gt;();&lt;br&gt;}&lt;/pre&gt;&lt;br/&gt;&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="2112" y="450" width="330" height="100" as="geometry" />
        </mxCell>
        <mxCell id="cZl-_tYypcyyZDHa4Ti2-1" value="ThreadLocal 类的使用方法，以Android中Looper举例" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FF0000;" parent="1" vertex="1">
          <mxGeometry x="2112" y="422" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uK6GI_ooJPnrXkrZsftc-3" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1914" y="481" as="sourcePoint" />
            <mxPoint x="1844" y="481" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uK6GI_ooJPnrXkrZsftc-5" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1929" y="510.71" as="sourcePoint" />
            <mxPoint x="1869" y="510.71" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uK6GI_ooJPnrXkrZsftc-6" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2125" y="506" as="sourcePoint" />
            <mxPoint x="2037" y="466" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uK6GI_ooJPnrXkrZsftc-7" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2128" y="536" as="sourcePoint" />
            <mxPoint x="1958" y="528" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2038" y="528" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uK6GI_ooJPnrXkrZsftc-10" value="" style="curved=1;endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1951.62" y="501" as="sourcePoint" />
            <mxPoint x="1921.62" y="641" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2090.37" y="491" />
              <mxPoint x="2090.37" y="611" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uK6GI_ooJPnrXkrZsftc-11" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1922" y="877" as="sourcePoint" />
            <mxPoint x="2112" y="877" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
