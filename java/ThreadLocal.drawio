<mxfile host="app.diagrams.net" modified="2024-04-09T03:53:55.872Z" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36" etag="pokKn_YCkhSPwh70SOyq" version="24.2.0" type="device">
  <diagram id="B5dIO6AN51XFmtcyMUDD" name="ThreadLocal">
    <mxGraphModel dx="466" dy="1531" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="4JSQju-QF8H9R8TIQm2g-1" value="ThreadLocal" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1720" y="40" width="200" height="130" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-2" value="&lt;div&gt;-&amp;nbsp;&lt;span style=&quot;font-size: 8px; background-color: initial;&quot;&gt;HASH_INCREMENT: int = 0x61c88647&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="4JSQju-QF8H9R8TIQm2g-1" vertex="1">
          <mxGeometry y="26" width="200" height="26" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="4JSQju-QF8H9R8TIQm2g-1" vertex="1">
          <mxGeometry y="52" width="200" height="8" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-4" value="+ set(T): void&lt;div&gt;+ get(): T&lt;br&gt;&lt;/div&gt;&lt;div&gt;getMap(Thread): ThreadLocalMap&lt;/div&gt;&lt;div&gt;createMap(Thread, T): void&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="4JSQju-QF8H9R8TIQm2g-1" vertex="1">
          <mxGeometry y="60" width="200" height="70" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-5" value="ThreadLocalMap" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1720" y="190" width="190" height="130" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-6" value="- INITIAL_CAPACITY: int = 16&lt;div&gt;- table: Entry[]&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="4JSQju-QF8H9R8TIQm2g-5" vertex="1">
          <mxGeometry y="26" width="190" height="44" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-7" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="4JSQju-QF8H9R8TIQm2g-5" vertex="1">
          <mxGeometry y="70" width="190" height="8" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-8" value="- set(T): void&lt;div&gt;- getEntry(ThreadLocal): Entry&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="4JSQju-QF8H9R8TIQm2g-5" vertex="1">
          <mxGeometry y="78" width="190" height="52" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-9" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;public void &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;set&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;T &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;value&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Thread &lt;/span&gt;t = &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Thread&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;currentThread&lt;/span&gt;();&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;ThreadLocalMap &lt;/span&gt;map = &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;getMap&lt;/span&gt;(t);&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(map != &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;)&lt;br style=&quot;font-size: 6px;&quot;&gt;        map.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;set&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;this&lt;/span&gt;, &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;value&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;else&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;createMap&lt;/span&gt;(t, &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;value&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;br&gt;&lt;pre&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;public &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;T &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;get&lt;/span&gt;() {&lt;br&gt;    &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Thread &lt;/span&gt;t = &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Thread&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;currentThread&lt;/span&gt;();&lt;br&gt;    &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;ThreadLocalMap &lt;/span&gt;map = &lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;getMap&lt;/span&gt;(t);&lt;br&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(map != &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;null&lt;/span&gt;) {&lt;br&gt;        &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;ThreadLocalMap&lt;/span&gt;.&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Entry &lt;/span&gt;e = map.&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;getEntry&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;this&lt;/span&gt;);&lt;br&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;if &lt;/span&gt;(e != &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;null&lt;/span&gt;) {&lt;br&gt;            &lt;span style=&quot;color: rgb(229, 192, 123); font-style: italic;&quot;&gt;@SuppressWarnings&lt;/span&gt;(&lt;span style=&quot;color: rgb(137, 202, 120);&quot;&gt;&quot;unchecked&quot;&lt;/span&gt;)&lt;br&gt;            &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;T &lt;/span&gt;result = (&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;T&lt;/span&gt;)e.&lt;span style=&quot;color: rgb(239, 89, 111);&quot;&gt;value&lt;/span&gt;;&lt;br&gt;            &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;return &lt;/span&gt;result;&lt;br&gt;        }&lt;br&gt;    }&lt;br&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;setInitialValue&lt;/span&gt;();&lt;br&gt;}&lt;/pre&gt;&lt;pre&gt;&lt;br&gt;&lt;pre&gt;&lt;br&gt;&lt;/pre&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="1900" y="451" width="212" height="180" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-11" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;private void &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;set&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;ThreadLocal&lt;/span&gt;&amp;lt;?&amp;gt; &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;, &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Object &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;value&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;// We don&#39;t use a fast path as with get() because it is at&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;    // least as common to use set() to create new entries as&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;    // it is to replace existing ones, in which case, a fast&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;    // path would fail more often than not.&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry&lt;/span&gt;[] tab = &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;table&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;len = tab.&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;length&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;i = &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;.threadLocalHashCode &amp;amp; (len-&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;for &lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry &lt;/span&gt;e = tab[i];&lt;br style=&quot;font-size: 6px;&quot;&gt;         e != &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;         e = tab[i = &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;nextIndex&lt;/span&gt;(i, len)]) {&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;// Android-changed: Use refersTo() (twice).&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;        // ThreadLocal&amp;lt;?&amp;gt; k = e.get();&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;        // if (k == key) { ... } if (k == null) { ... }&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(e.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;refersTo&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;)) {&lt;br style=&quot;font-size: 6px;&quot;&gt;            e.&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;value &lt;/span&gt;= &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;value&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;        }&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(e.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;refersTo&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;)) {&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;replaceStaleEntry&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;, &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;value&lt;/span&gt;, i);&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;        }&lt;br style=&quot;font-size: 6px;&quot;&gt;    }&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;    tab[i] = &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;, &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;value&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;sz = ++&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;size&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(!&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;cleanSomeSlots&lt;/span&gt;(i, sz) &amp;amp;&amp;amp; sz &amp;gt;= &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;threshold&lt;/span&gt;)&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;rehash&lt;/span&gt;();&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="1862" y="631" width="250" height="270" as="geometry" />
        </mxCell>
        <mxCell id="4JSQju-QF8H9R8TIQm2g-13" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;private &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;getEntry&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;ThreadLocal&lt;/span&gt;&amp;lt;?&amp;gt; &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;i = &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;.threadLocalHashCode &amp;amp; (&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;table&lt;/span&gt;.&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;length &lt;/span&gt;- &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry &lt;/span&gt;e = &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;table&lt;/span&gt;[i];&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;// Android-changed: Use refersTo().&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(e != &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null &lt;/span&gt;&amp;amp;&amp;amp; e.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;refersTo&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;))&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return &lt;/span&gt;e;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;else&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;        return &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;getEntryAfterMiss&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;key&lt;/span&gt;, i, e);&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="1862" y="900" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Usvd829vFf0LGTeXWWfx-1" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;ThreadLocalMap &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;getMap&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;t&lt;/span&gt;) {&lt;br&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;t&lt;/span&gt;.threadLocals;&lt;br&gt;}&lt;/pre&gt;&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;pre&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;void &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;createMap&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;t&lt;/span&gt;, &lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;T &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;firstValue&lt;/span&gt;) {&lt;br&gt;    &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;t&lt;/span&gt;.threadLocals = &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;new &lt;br/&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;ThreadLocalMap&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;this&lt;/span&gt;, &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;firstValue&lt;/span&gt;);&lt;br&gt;}&lt;/pre&gt;&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="1722" y="467" width="180" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Usvd829vFf0LGTeXWWfx-3" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;ThreadLocalMap&lt;/span&gt;(&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;ThreadLocal&lt;/span&gt;&amp;lt;?&amp;gt; &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;firstKey&lt;/span&gt;, &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Object &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;firstValue&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;table &lt;/span&gt;= &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry&lt;/span&gt;[&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;INITIAL_CAPACITY&lt;/span&gt;];&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;i = &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;firstKey&lt;/span&gt;.threadLocalHashCode &amp;amp; (&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;INITIAL_CAPACITY &lt;/span&gt;- &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;table&lt;/span&gt;[i] = &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;firstKey&lt;/span&gt;, &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;firstValue&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;size &lt;/span&gt;= &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;setThreshold&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;INITIAL_CAPACITY&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;br/&gt;&lt;pre&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;private void &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;setThreshold&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;len&lt;/span&gt;) {&lt;br&gt;    &lt;span style=&quot;color: rgb(239, 89, 111);&quot;&gt;threshold &lt;/span&gt;= &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;len &lt;/span&gt;* &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;2 &lt;/span&gt;/ &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;3&lt;/span&gt;;&lt;br&gt;}&lt;/pre&gt;&lt;br/&gt;&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="2112" y="631" width="290" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Usvd829vFf0LGTeXWWfx-7" value="&lt;div style=&quot;font-size: 8px;&quot;&gt;ThreadLocal对象进行set(T)的时候，会获取当前线程中的ThreadLocalMap对象；然后将数据存放在ThreadLocalMap中。&lt;/div&gt;每个线程都有一个ThreadLocalMap，里面存放的数据是Entry数组，每个Entry是以ThreadLocal为key，T为value进行存储；" style="whiteSpace=wrap;html=1;align=left;fontSize=8;" parent="1" vertex="1">
          <mxGeometry x="1962" y="232" width="270" height="60" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-2" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;private static int &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;nextIndex&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;i&lt;/span&gt;, &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;len&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return &lt;/span&gt;((&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;i &lt;/span&gt;+ &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1 &lt;/span&gt;&amp;lt; &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;len&lt;/span&gt;) ? &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;i &lt;/span&gt;+ &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1 &lt;/span&gt;: &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;0&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;private static int &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;prevIndex&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;i&lt;/span&gt;, &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;len&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;return &lt;/span&gt;((&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;i &lt;/span&gt;- &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1 &lt;/span&gt;&amp;gt;= &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;0&lt;/span&gt;) ? &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;i &lt;/span&gt;- &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1 &lt;/span&gt;: &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;len &lt;/span&gt;- &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="1693" y="726" width="170" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-4" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;private void &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;rehash&lt;/span&gt;() {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;expungeStaleEntries&lt;/span&gt;();&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;// Use lower threshold for doubling to avoid hysteresis&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;size &lt;/span&gt;&amp;gt;= &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;threshold &lt;/span&gt;- &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;threshold &lt;/span&gt;/ &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;4&lt;/span&gt;)&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;resize&lt;/span&gt;();&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;/**&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt; * Double the capacity of the table.&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt; */&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;private void &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;resize&lt;/span&gt;() {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry&lt;/span&gt;[] oldTab = &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;table&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;oldLen = oldTab.&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;length&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;newLen = oldLen * &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;2&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry&lt;/span&gt;[] newTab = &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry&lt;/span&gt;[newLen];&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;count = &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;0&lt;/span&gt;;&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;for &lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;j = &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;0&lt;/span&gt;; j &amp;lt; oldLen; ++j) {&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Entry &lt;/span&gt;e = oldTab[j];&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(e != &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;ThreadLocal&lt;/span&gt;&amp;lt;?&amp;gt; k = e.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;get&lt;/span&gt;();&lt;br style=&quot;font-size: 6px;&quot;&gt;            &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(k == &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;                e.&lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;value &lt;/span&gt;= &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;; &lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;// Help the GC&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(92, 99, 112); font-style: italic; font-size: 6px;&quot;&gt;            &lt;/span&gt;} &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;else &lt;/span&gt;{&lt;br style=&quot;font-size: 6px;&quot;&gt;                &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;int &lt;/span&gt;h = k.threadLocalHashCode &amp;amp; (newLen - &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;1&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;                &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;while &lt;/span&gt;(newTab[h] != &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;)&lt;br style=&quot;font-size: 6px;&quot;&gt;                    h = &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;nextIndex&lt;/span&gt;(h, newLen);&lt;br style=&quot;font-size: 6px;&quot;&gt;                newTab[h] = e;&lt;br style=&quot;font-size: 6px;&quot;&gt;                count++;&lt;br style=&quot;font-size: 6px;&quot;&gt;            }&lt;br style=&quot;font-size: 6px;&quot;&gt;        }&lt;br style=&quot;font-size: 6px;&quot;&gt;    }&lt;br style=&quot;font-size: 6px;&quot;&gt;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;setThreshold&lt;/span&gt;(newLen);&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;size &lt;/span&gt;= count;&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(239, 89, 111); font-size: 6px;&quot;&gt;table &lt;/span&gt;= newTab;&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="2111" y="859" width="260" height="310" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-7" value="Thread" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fontSize=8;" parent="1" vertex="1">
          <mxGeometry x="2020" y="40" width="180" height="52" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-8" value="+ threadLocals: ThreadLocal.ThreadLocalMap" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-7" vertex="1">
          <mxGeometry y="26" width="180" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-11" value="" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=0;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;whiteSpace=wrap;html=1;fontSize=8;" parent="1" vertex="1">
          <mxGeometry x="2240" y="70" width="152" height="208" as="geometry">
            <mxRectangle x="1170" y="410" width="50" height="40" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-16" value="entry: Entry --&amp;gt; (ThreadLocal, Tvalue)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-11" vertex="1">
          <mxGeometry width="152" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-18" value="entry1: Entry&amp;nbsp;--&amp;gt; (ThreadLocal, Tvalue)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-11" vertex="1">
          <mxGeometry y="26" width="152" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-19" value="entry2: Entry&amp;nbsp;--&amp;gt; (ThreadLocal, Tvalue)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-11" vertex="1">
          <mxGeometry y="52" width="152" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-21" value="entry3: Entry&amp;nbsp;--&amp;gt; (ThreadLocal, Tvalue)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-11" vertex="1">
          <mxGeometry y="78" width="152" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-23" value="entry4: Entry&amp;nbsp;--&amp;gt; (ThreadLocal, Tvalue)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-11" vertex="1">
          <mxGeometry y="104" width="152" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-24" value="entry5: Entry&amp;nbsp;--&amp;gt; (ThreadLocal, Tvalue)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-11" vertex="1">
          <mxGeometry y="130" width="152" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-25" value="entry6: Entry&amp;nbsp;--&amp;gt; (ThreadLocal, Tvalue)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-11" vertex="1">
          <mxGeometry y="156" width="152" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-26" value="......" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontSize=8;" parent="YRkNxRZ61KOj2W9NJHFv-11" vertex="1">
          <mxGeometry y="182" width="152" height="26" as="geometry" />
        </mxCell>
        <mxCell id="YRkNxRZ61KOj2W9NJHFv-28" value="" style="endArrow=open;endFill=1;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=-0.019;entryY=0.33;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=8;" parent="1" source="YRkNxRZ61KOj2W9NJHFv-8" target="YRkNxRZ61KOj2W9NJHFv-16" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2232" y="270" as="sourcePoint" />
            <mxPoint x="2392" y="270" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fzmKr-huMYEFjz7aQjL3-1" value="&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;pre&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;static final &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;ThreadLocal&lt;/span&gt;&amp;lt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Looper&lt;/span&gt;&amp;gt; &lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;sThreadLocal &lt;/span&gt;= &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;ThreadLocal&lt;/span&gt;&amp;lt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Looper&lt;/span&gt;&amp;gt;();&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;color: rgb(187, 187, 187); font-size: 6px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;private static void &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;prepare&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;quitAllowed&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;sThreadLocal&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;get&lt;/span&gt;() != &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;null&lt;/span&gt;) {&lt;br style=&quot;font-size: 6px;&quot;&gt;        &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;RuntimeException&lt;/span&gt;(&lt;span style=&quot;color: rgb(137, 202, 120); font-size: 6px;&quot;&gt;&quot;Only one Looper may be created per thread&quot;&lt;/span&gt;);&lt;br style=&quot;font-size: 6px;&quot;&gt;    }&lt;br style=&quot;font-size: 6px;&quot;&gt;    &lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;sThreadLocal&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239); font-size: 6px;&quot;&gt;set&lt;/span&gt;(&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic; font-size: 6px;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-size: 6px;&quot;&gt;Looper&lt;/span&gt;(&lt;span style=&quot;color: rgb(209, 154, 102); font-size: 6px;&quot;&gt;quitAllowed&lt;/span&gt;));&lt;br style=&quot;font-size: 6px;&quot;&gt;}&lt;br/&gt;&lt;pre&gt;&lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;public static &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123); font-style: italic;&quot;&gt;@Nullable &lt;/span&gt;&lt;span style=&quot;color: rgb(229, 192, 123);&quot;&gt;Looper &lt;/span&gt;&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;myLooper&lt;/span&gt;() {&lt;br&gt;    &lt;span style=&quot;color: rgb(213, 95, 222); font-style: italic;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;color: rgb(209, 154, 102);&quot;&gt;sThreadLocal&lt;/span&gt;.&lt;span style=&quot;color: rgb(97, 175, 239);&quot;&gt;get&lt;/span&gt;();&lt;br&gt;}&lt;/pre&gt;&lt;br/&gt;&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;fontSize=6;fillColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="2112" y="450" width="330" height="100" as="geometry" />
        </mxCell>
        <mxCell id="cZl-_tYypcyyZDHa4Ti2-1" value="ThreadLocal 类的使用方法，以Android中Looper举例" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FF0000;" parent="1" vertex="1">
          <mxGeometry x="2112" y="422" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uK6GI_ooJPnrXkrZsftc-3" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1914" y="481" as="sourcePoint" />
            <mxPoint x="1844" y="481" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uK6GI_ooJPnrXkrZsftc-5" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1929" y="510.71" as="sourcePoint" />
            <mxPoint x="1869" y="510.71" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uK6GI_ooJPnrXkrZsftc-6" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2125" y="506" as="sourcePoint" />
            <mxPoint x="2037" y="466" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uK6GI_ooJPnrXkrZsftc-7" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2128" y="536" as="sourcePoint" />
            <mxPoint x="1958" y="528" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2038" y="528" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uK6GI_ooJPnrXkrZsftc-10" value="" style="curved=1;endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1951.62" y="501" as="sourcePoint" />
            <mxPoint x="1921.62" y="641" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2090.37" y="491" />
              <mxPoint x="2090.37" y="611" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uK6GI_ooJPnrXkrZsftc-11" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#FFFFFF;strokeWidth=0.5;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1922" y="877" as="sourcePoint" />
            <mxPoint x="2112" y="877" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
